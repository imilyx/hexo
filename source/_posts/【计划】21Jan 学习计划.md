---
title: '21Jan 学习计划'
date: 2021-01-31 23:59:59
tags: 
mathjax: true
---

新年新坑~

## $\mathcal{1.2}$
---

Todo: vp UOJ，订正今天模拟赛, 订正胡策 4，vp AGC012/043，学习斯特林数，巩固 SAM 和生成函数，uoj交互题，清华集训14、16、17，集训队作业，EI与动态图
loj560, 3104

SAM
PAM
最长反链
FWT exp ln

agc023e
agc023d
agc020f
agc032e
agc035e
agc029f

订正昨天 T1
ULR T2&3
指数公式 https://loj.ac/p/6737
checkers https://www.luogu.com.cn/problem/AT3951

联合省选2020
九省联考
八省联考
六省联考
ZJOI

### $XJOI1640$

#### $T1$

sb 题？读入格式错了我吐

#### $T2$

没听懂

#### $T3$

可以证明 $A = g^a$, $B = g^b$, 就解一个不定方程。

### $XJOI1641$

#### $T1$

高斯消元成上三角形式，$min$ 就是所有有主元的列答案加起来，$max$ 就是除了最高位外其余位至少有一个 $0$.

#### $T2$

hhz 说打个表发现是线性递推，跑 $BM$ 就行了，他不会证。

他提供了另一个思路——生成函数，容斥“相同”这件事，分成若干个集合，强制集合里的物品相同，容斥系数 $(-1)^{集合个数 + 1}$, 然后这个用生成函数。

#### $T3$

异或粽子！$K = n(n - 1) / 2$，那没事了。考虑当前在算 $x$ 和 $y$ 为根的 $Trie$ 树子树异或贡献，如果 $x0$、$y1$ 和 $x1$、$y0$ 贡献已经到 $K$ 了就递归做这俩，否则递归做 $x0$、$y0$ 和 $x1$、$y1$，每个 $Trie$ 树节点都要维护子树每位信息。看似两只 $log$，其实实现的精细一点就是一只 $log$，比如只记录儿子有的位的信息（即深度 $d$ 的点只记录 $d$ 及以后位的信息），然后空间用长链剖分优化。

为什么这样复杂度就是对的？考虑单儿子的点，判断是 $O(1)$ 的，空间就继承了；考虑双儿子的点，判断 $O(logV)$，然而 $Trie$ 树有个重要性质：**双儿子点只有 $O(n)$ 个**，所以是 $O(nlogV)$ 的。

### [$养猫$](https://loj.ac/p/6079)

单独写博客了。

### [$THUPC2021$](https://loj.ac/p?keyword=thupc%202021)

#### 切切糕

有意思的题。发现算 $Kiana$ 没法做，只能算 $Tinytree$ 在双方最优策略下的最大切糕总和。$dp_{i, j}$ 表示切了 $i$ 块糕，使用了 $j$ 次优先选择权，有 $dp_{i, 0} = 0$, $dp_{i, i} = \frac{\sum\limits_{j = 1}^i a_j}{2}$。转移方程: $dp_{i, j} = \max{ dp_{i - 1, j} + x, dp_{i - 1, j - 1} + y }$，其中 $x + y = a_i$, $x < y$. 这是两个一次函数，要最小必然使得两者相等，于是解方程解出 $x$ 即可。

#### 棋盘

赛场 WA 成 dog 的痛苦你懂吗。后来机房里有人构造出能卡的数据了，但是我 naive 以为我这做法从根本上就错了，实际上只要考虑一种情况：$n$ 为奇数，相邻两列撑满，且这两列距离为偶数。这就需要乱搞了——之间的列从上往下填，填不动了再从下往上填。

#### 线段树

发现答案只和长度有关，而长度只有 $O(logn)$ 种。算一个长度的答案需要统计左区间贡献、右区间贡献和所有跨中点区间的贡献，要维护前后缀贡献和。

#### 密集子图

$1$ 到达每个点的最短路长度不超过 $11$，想到在最短路树上分层状压 $dp$（从浅到深和从深到浅显然都可以）。已有点集中只有上一深度的点能向当前点集连边，且当前点集中每个点都和至少一个上一深度的点连边。$dp_{d, s1, s2}$ 表示深度为 $d$ 的集合为 $s2$，深度 $\leq d$ 的集合为 $s1$，转移枚举两次子集，复杂度 $O(n4^n)$，卡我常不讲武德。

### [$Fygon\ 2.0$](https://codeforces.com/gym/101612/)

把这个 for 循环看作
```
i in range(1, n)
    if (j <= i && i <= k)
```

根据不等关系建图，是有向图，先缩点——显然有环的话（比如 $1$ -> $i$ -> $j$ -> $1$）缩点后一个 $SCC$ 里的变量取值相同。
缩完是个 $DAG$，$DAG$ 点数就是 $n$ 的次数。

那么系数是啥？考虑其意义，系数就是实际 $lag$++ 的次数占 $n^{DAG 点数}$ 的几分之几。
不考虑存在 $SCC$ 取值相同的情况，因为次数会减小，而我们假定 $n$ 趋近于 $\infty$
答案就是 $\frac{DAG 的拓扑序个数}{DAG 点数!}$，状压就好了。

### [$文学$](https://uoj.ac/problem/47)

题意：给你很多半平面，让你选一些包含所有点。

特判掉只选一个半平面的情况，剩下的都有至少两个半平面且半平面的补的交为凸包（显然半平面是向外的啊），于是枚举两个半平面，以它们的交点为基准点对所有书本极角排序（因为当枚举的两个半平面在答案集合中为相邻的，它们的交就是凸包上的一个端点，那么其他书本关于它极角排序后在最终的答案半平面集合中一个半平面覆盖一段连续区间的书本），于是先预处理每个区间被一个半平面覆盖的最小代价，再拼起来就完事了。

### [$Buffalo\ Barricades$](https://ioihw20.duck-ac.cn/problem/290)

**仔细读题。** 观察发现若 $x_i > x_j$, $y_i > y_j$, $t_i < t_j$ 则 $i$ 的牛群包含 $j$ 的牛群。如果不看操作编号，我们算出每个栅栏直接统领的牛数，根据包含关系建树（如果有多个包含 $j$ 的就选时间最小的 $i$，显然是个森林），那么子节点答案加给父亲节点就好了。

考虑操作编号，我们只要保证子树中所有操作编号大于根的点的答案都已被算好——这还不明显嘛，时间倒流 + 并查集就可以啦。

一只 $log$，感觉好小清新啊~~ 树套树什么的大概可以轻易做到两只 $log$ 吧。

## $\mathcal{1.5}$
---

### [$Epic\ Win!$](https://codeforces.com/gym/100553/problem/E)

造自动机题。可以采取这样的策略：先建一个对手自动机的副本，其中每个节点状态是克制原节点的，我们称之为“吊打自动机”，吊打自动机每个节点只有一条出边，剩下两条出边是做调整用。

为了使得对手从任意节点开始我都能赢，我们要让自动机适用于对手每个节点，不如把我们的自动机分层，一层对付对手一个点。从对手自动机每个节点出发一直跑跑跑，如果跑过的路程超出了我们自动机当前点数就认为存在胜利的环，否则跑到不存在下个克制对手的状态边时新加一层自动机，这样点数 $n^2$，复杂度 $n^3$。

### [$Indiana\ Jones\ and\ the\ Uniform\ Cave$](https://www.luogu.com.cn/problem/P7123)

是一个大 $SCC$，想到用 $tarjan$ 相关模拟 $dfs$。

很有意思，用仅有的信息来表示 dfn、low 和 ins。石头 center、left、right 分别对应未访问、已弹出栈和在栈中。

如果访问到点在栈中，就顺着石头摆放的位置一路走下去，并把沿途的位置石头放在 left，碰到的第一个 left 的点说明走回去了；如果访问到点不在栈中，就一直走到访问到栈中点为止。很好的是记录路径长度就可以算出 low，回到父亲。

（还是没想太明白，代码咕咕

### [须臾幻境](https://www.luogu.com.cn/problem/P5385)

$LCT$ 维护啥呢。考虑 $u$ 和 $v$ 联通，当且仅当有一条路径全部 $\geq l$（废话

那么 $LCT$ 维护每次 $r$ 右移后形成的最大生成树（要形成环的时候踢掉最小的边。众所周知 LCT 只能维护点，所以化边为点，注意非边点的点权要赋为 $\infty$），$连通块数 = 点数 - 边数 = n - [l, r] 中在最大生成树上的边数$.

一条边只会加入一次，删除至多一次。相当于要查询 $i \in [l, r]$ 且删除时间 $del_i > r$ 的边数，二维数点即可。（主席树都不会写了 /kel

### $XJOI1643$

出于各种奥妙重重的原因抱灵辽。

#### $T1$

状压模拟拓扑，一开始选 $0$ 度点的过程错了，到手的 $10$ 分飞了

**给出的序列是无序的。** 变形一下，把依赖 $x$ 的 $y$ 都挂在 $x$ 下，因为只有后 $n - m$ 个点依赖前 $m$ 个点的份，这是个菊花森林。每个 $x$ 算上它的子树有一个权值区间。我们把 $x$ 们按照权值区间右端点排序，然后走来走去收贡献。

不会走“包含型”的区间，它不优；并且一定是从起点开始往左（或右，应该都可以）走到底然后一路走回来，最后结束在最左或最右边的边界上。往左经过的是区间并，前缀 $min$/$max$ 可以预处理，注意走回来是两倍区间并长。

#### $T2$

hhz：网络流本质是特殊的线性规划。建议学习单纯形法，利于骗分。

考虑加完边的最短路图，$d_u + 1 \leq d_v$。这题怎么网络流？边权只有 $O(n)$ 种，建 $n$ 行 $n$ 列点表示 $n$ 种点的 $n$ 种权值，割掉边就表示选了这种权值，相邻连边容量为题目中那个下取整柿子。题目中的 $m$ 条边是来给限制的，考虑这限制是什么，这两个点的最短距离差不能 $> 1$，于是通过连反向 $\infty$ 边来实现。

#### $T3$

没输 no solution 到手的 $5$ 分飞了 凸^-^凸

暴力就枚举 $A$ 和 $B$ 的最大值，如果“存在连通块大小 $\geq k$” 则该最大值对合法。

正解考虑枚举 $A$ 的最大值，发现随着它增加，最小的使得“存在连通块大小 $\geq k$” 的 $B$ 最大值 变小。

于是可以动态加边删边，因为考虑两条边 $e_1$ 先于 $e_2$ 被删，当且仅当 $\max{ b_{u_1}, b_{v_1} } \geq \max{ b_{u_2}, b_{v_2} }$，所以边按这个 $max$ 排序，$LCT$ 维护 $MST$ 即可！！！当然也可以把点排序，但是不能一维枚举点、一维枚举边，这样大概会有重有漏。

胡完了，真好【躺平】写了一晚上 + 早上两小时，真有我的！

### $ULR$#$1$

单独写博客了。

## $\mathcal{1.6}$
---

### $XJOI1644$

挂分++，一个快速幂写挂两处真有我的，md

#### $T1$

可以分治算柿子，也可以矩乘加速 $dp$。所以你为什么只想到了 exCRT 合并模数？

#### $T2$

考虑一个一个加物品。$(a_x, a_y)$ 和 $(b_x, b_y)$ 合并得到 $(X, Y)$ $(0, Z)$，其中 $X = gcd(a_x, a_y)$。为什么是这样？$X$ 是 $a$ 和 $b$ 合并得到的第一维的最小“单位”，$Y$、$Z$ 相当于第二位的最小“单位”。

#### $T3$

对于 $n \leq 5$ 特判。其余 $n$ 为奇数时一定不行，$n$ 为偶数时，只有 $n / 2$ 是质数且 $n / 2 - 1$ 无平方因子时可以。证明据说历史上都找不到，于是咕咕。

### [$AT4144-Donation$](https://www.luogu.com.cn/problem/AT4144)

做过好多遍的套路了，脑袋还是不清醒。考虑在 $i$ 点结束后的钱为 $x$，那么 $x + b_i \geq a_i$, $x \geq a_i - b_i$。

考虑捐赠完 $i$ 再捐赠 $j$ 的最小钱数 $y$，设捐赠完 $j$ 后为 $x$，那么 $y = \max{x + b_j, a_i - b_i}$. 显然按 $a_i - b_i$ 从大到小捐赠最优。我们一个点只捐赠一次，在最后一次经过它时捐赠。并查集维护子树，$dp$。

### [$Bears\ and\ Juice$](https://www.luogu.com.cn/problem/CF643F)

[大佬的靠谱题解](https://www.luogu.com.cn/blog/CYJian/solution-cf643f)

想了好久才明白。xml，菜！

正如大佬所说的，我们先制定一个策略，安排好哪些熊哪天喝哪些酒，使得能够**根据熊的表现推断出哪个桶有酒。** 因为这是我们唯一能获知的信息。

形式化的，我们对每个桶各列一张日程表，第 $i$ 行第 $j$ 列为 $1$ 表示第 $i$ 天第 $j$ 头熊喝了这桶液体。**这张日程表对应的是：如果这桶是酒，熊的表现。**

桶有标号，两个桶的日程表不能相同不然就无法与熊的表现一一对应，问题转化为**本质不同日程表计数**。显然 $R_d = \sum\limits_{i = 0}^{\min(n - 1, p)} \binom{n}{i} D^i$，即枚举睡着的熊个数，以及在哪天睡着的。

最后一步是处理这个柿子。$5s$, $O(pq)$ 是可以过的！【震惊】我们只需要预处理组合数，$p^2$ 约去分子和分母的公因数，显然分子一定会被消成 1。

## $\mathcal{1.7}$
---

### [$XJOI1646$]

今天的题烂极了，$T1$ 裸费用流，要 $dij$，$n^2$ 版本因为 $m$ 是 $n^2$ 级别而 $dij$ 复杂度是 $mlogn$；$T2$ $SAM$/$SA$ + 线段树几乎是裸题；$T3$ dancing links 裸题，我不会所以抱灵了。是冬令营模拟赛没错吧，xy 你醒醒！

最可气的是我吧，$T2$ 没判
```
if (i + lcp > n) continue;
```
$RE$ 丢 $70$，qswl

# xml 你写题必须考虑边界

hhz 说 $DLX$ 现在不大会考，所以不订正。

### [虫逢](https://uoj.ac/problem/45)

毫无头绪，只能膜题解。暴力做显然补星，本质是比较的对数太多了，考虑随机化减少比较。确定思考方向：最大化同源虫子的比较概率且尽量让不同源虫子的比较概率小。注意这里的“比较概率”指的是**有机会进行比较的概率**。

随机为每个基因分配权值，定义一个虫子的关键值是它的基因最小值，那么一对虫子**有机会**进行比较当且仅当它们关键值相同，即一对同源虫子比较概率是 $1/3$（假设它们的基因集合分别为 $\{X, Y\}$, $\{X, Z\}$，设最小值在 $X$ 处的概率为 $P$，则显然最小值在 $Y$、$Z$ 处的概率也是 $P$，$P = 1/3$），一对不同源虫子比较概率是 $1/L$（题目输入格式那里说的是“集合”，我就理解为一只虫子的基因组里基因不重啦，给出的基因最劣就只有 $L$ 种啦）。

同源虫子比较概率够大了，不同源虫子的比较概率却太大了。考虑为每个基因分配两个权值（其实就是双模 $hash$ 啦），两个概率分别变为 $1/9$ 和 $1/n$，做一次期望成功匹配 $n/9$ 对，期望做 $9$ 次，可以接受。

[$Code$](https://uoj.ac/submission/446541)

### [量子破碎](https://uoj.ac/problem/328)

别人说一眼 $FWT$，我连 $FWT$ 原理都忘掉了，赶快去复习。

只能用前两个操作，第一个返回任意一个值不为 $0$ 的下标且返回后就重置序列，第二个那个 $+ 2^i$ 的形式很像 $FWT$。**题目保证 $X \oplus Y$ 不变。**

考虑构造 $A$ 矩阵使得它就是 $FWT$（允许乘上系数），普通的 $FWT$ 矩阵是这样的：

$$
\begin{bmatrix} 1 & 1 \\ 1 & -1 \end{bmatrix}
\quad
$$

但它不满足 $AA^T = I$（手玩即可验证）。事实上让矩阵每个元素乘上 $\frac{1}{\sqrt{2}}$ 这个系数即可。

现在我们能用操作二做 $FWT$ 了！考虑它实现了什么，以建立与操作一的联系：$a'_T = ( (-1)^{|T \cap X|} + (-1)^{|T \cap Y|} )a_X$（$a_X = a_Y$），而这个玩意只有在 $|T \cap X|$ 和 $|T \cap Y|$ 奇偶性相同的情况下才不为 $0$。由 $FWT$ 的推导过程可知，$T \cap (X \oplus Y)$ 为偶数。也就是说 query() 返回的任何值与 $X \oplus Y$ 的 $And$ 为偶数。由于随机，期望 $O(n)$ 次出解（[官方题解](https://wuhongxun.blog.uoj.ac/blog/3112)有详细说明，我不是很懂QAQ，只是觉得这玩意概率挺正确）

[$Code$](https://uoj.ac/submission/446587)

### [AGC026F-Manju\ Game]

[周指导博客](https://www.cnblogs.com/zhouzhendong/archive/2004/01/13/AGC026F.html)

好妙的博弈啊。$n$ 为偶数，$A$ 随便选个不是端点的点都会丢掉先手的优厚权利，只能从某个端点取。

$n$ 为奇数，$A$ 显然也不会选奇数位，先计入从端点开始取完的策略，剩下那一定是 $A$ 选了若干次偶数位后剩下一个长度为奇数的区间，$A$ 从端点开始取完。

考虑建出策略的二叉树，那些叶子代表着最后剩下的长度为奇数的区间。$A$ 的获益可以分为 $[1, l - 1]$ 偶数位，$[l, r]$ 奇数位，$[l + 1, n]$ 偶数位。从另一种角度看，二相当于区间取反。一、三都是确定的，二怎么算呢？B 会尽量导向劣的奇数长度区间，那我们要最大化最劣的奇数长度区间里 $A - B$ 的贡献，二分就可以了。

### [$Harry\ the\ Potter$](https://www.luogu.com.cn/problem/CF1286F)

破特！。好来讲这题，考虑连边，形成树，这树若是成功删为全 $0$ 那么相当于省了一次操作，否则单点操作不会更劣。考虑哪些点能组成森林，先预处理一棵树能否成功删完。

先不考虑 $\pm 1$，我们从叶子删到根，每个节点对根最终值的贡献的符号为深度奇偶性。考虑 $\pm 1$，设奇数层为 $A$，偶数层为 $B$，我们发现只要 $|sum(A) - sum(B)| < |S|$ 且 $|S - 1|$ 与 $sum(S)$ 奇偶性相同则能删完。

$O(3^n)$ 枚举子集不太乐观，考虑折半搜索，形成的两个权值集合分别排序，匹配，复杂度是 $\sum\limits_{i = 0}^{|S|} \binom{|S|}{i} 2^{\frac{|S|}{2}}$，二项式定理一算是 $O((1 + \sqrt{2})^n)$。后面跑个子集卷积自己卷自己 $n$ 次，或者直接 $O(3^n)$ 也没慢到哪去（什

## $\mathcal{1.8}$
---

### $XJOI1645$

今天是学习新知识场。

#### $T1$

学习 $PAM$ ing。重要性质：**一个串的本质不同回文子串个数是 $O(n)$ 级别的**（其实这点也可以从 $manacher$ 看出来）。

二分答案。不能同时出现一个串和它的子串，这对应在 $PAM$ 上就是建出由 $(x, ch[x, -])$ 和 $(x, fail[x])$ 组成的 $DAG$ 后在 $DAG$ 上求最长反链。什么你不知道什么是最长反链？[指路caiji blog]()。

#### $T2$

LCT 没法让一对点的子树信息都正确！只能 $siz[y] - lit[y] - 1$ 了。

#### $T3$

hhz 扔个柿子就跑了 “这是 $Pollard-Rho$ 板题”：

$$\sum\limits_{d | n} \sum\limits_{g | d} \mu(g) \phi(d)^K \sum\limits_{i = 1}^{\lfloor \frac{n}{gd} \rfloor} ig$$

对每个 $K$ 跑一遍 $P-R$。但我不会而且并不太想订，所以咕咕。。

### [$Raining\ Season$](https://codeforces.com/contest/1019/problem/E)

容易发现我们要求的是**朝下**的半平面交。普通的半平面交对本题没有启发性。实际上它可以用和求**上**凸壳几乎一样的方法解决，只需要把 $ax + b$ 看作 $(a, b)$。为什么？假设半平面交有 $a$ 和 $b$，弹 $b$ 出栈的条件是 $a$ 和 $b$ 的交点在 $c$ 下面；凸包弹 $b$ 出栈的条件是 $(b - a) \times (c - a) > 0$；把两个柿子展开发现是一样的。[大佬博客写得挺详细。](https://trinkle.blog.uoj.ac/blog/235)

所以边分 + 闵可夫斯基合并凸包即可。**注意：边分两倍空间。**

[$Code$](https://codeforces.com/contest/1019/submission/103716170)

## $\mathcal{1.9}$
---

### [$LOJ6275-棋盘$](https://loj.ac/p/6275)

dp，$f_{i, s, j}$ 表示做完 $i$ 列，末列状态为 $s$，连通块 $j$ 个的方案数。建立 $f$ 的 OGF：$F_{i, s} = \sum\limits_{j = 0}^{nm} f_{i, s, j} x^j$，则有 $F_{i, s} = \sum F_{i - 1, s'}$，第二维看作矩乘 $F_i = F_{i - 1} * A$，我们要求的即是 $ans = \sum_s [x^k] A^m$。

多项式乘法显然不现实，带单位根进去求出多项式点值再 $IDFT$ 回来就好。

* 坑点：存在合并连通块的情况。要把 '101' 拆成没有不会合并和可能合并两个状态。例如：
```
不合并：       可能合并：
11           11
00           10
01           11
``` 

[$Code$](https://loj.ac/s/1029957)

 
## 突然的安排，要回归文化课三周了，希望水平不降反升（你贪心了）

# *春宵苦短，少女前进吧！*

学习二进制分组思想：在线，维护 $logn$ 个块，大小分别为 $2^k$, $2^{k - 1}$, $\cdots$, 动态往末尾插入新元素，当第 $i$ 块的 $size$ = 第 $i - 1$ 块的 $size$ 时就合并 $i$ 和 $i - 1$，查询就在 $logn$ 个块上二分，复杂度 $O(n * T(n) * logn)$，其中 $T(n)$ 时合并一次的复杂度。证明可以均摊分析（类似二进制加法），“到下一次操作的时间和块大小相等”，设 $n \cdot T(n)$ 为处理大小为 n 的块的时间，$O(\sum\limits_{i = 1}^{logn} \frac{n}{2^i} \cdot 2^i \cdot T(2^i) ) = O(n \cdot T(n) \cdot logn)$

### [玄学](https://uoj.ac/problem/46)

首先这操作支持复合。看到查询操作想到二进制拆分什么的... 没错，二进制分组，以操作为下标，每个块维护序列——显然有很多相邻位置的操作相同（因为 $q$ 个操作只会造成 $O(q)$ 种不同操作），把每块缩成一个点就好，总点数一只 $log$（不过是 $nlogn$ 还是 $qlogq$ 啊？），合并复杂度是 $O(块大小)$，归并即可。

[$Code$](https://uoj.ac/submission/447523)

## $\mathcal{1.16}$
---

经历了一周的whk摧残，现在来报个平安 [抱拳]

### $XJOI1651$

#### $T1$

就是 $0 \leq pre_i \leq pre_n$ 啦。画折线图发现 $C$ 都选，$T$ 选不选要考虑会不会让前面的 $\max{pre_i}$ 超过 $pre_n$，$O(Qn)$

照着折线图胡结论：$ans = -(pre_{mn} + suf_{mn})$，其中 $pre_{mn}$ 和 $suf_{mn}$ 不重叠，首先 $ans$ 必然不会小于这个东西，其次不会更大，如果更大意味着中间地带有前后缀为负数，矛盾。

#### $T2$

hhz 说看成一个状态的 dfs 树，每次匈牙利找一条增广环（显然要环，才能从一个完美匹配变成另一个完美匹配），复杂度 O(Knm)，因为 dfs 树点数为 O(Kn)，单次匈牙利为 O(m)

把 dfs 树怎么缩成二叉树，就变成 O(Km) 了？每次匈牙利不局限于找定点的增广环而是找全局的增广环？不太懂。

#### $T3$

[原题](https://www.luogu.com.cn/problem/P6499) 就是问你能否用 $K$ 个点堵住根到所有叶子的路径。首先裁剪树，剪掉深度 $> K$ 的和深度不足 $K$ 的子树（设根深度为 $0$）。考虑最坏情况，根下挂着 $K$ 条长度为 $K$ 的链，每次堵一个深度为 $i$ 的点，$K$ 次刚好堵完；其余情况也就是有多叉的点，一次堵可能会堵掉多个叶子，所以上面那种是最坏情况。

S 只有在 $n > K * K + 1$ 时才获胜，所以 $K > 19$ 时直接 DA。一个深度选一个点，状压，$f[i, s]$ 表示选了深度集合为 $s$ 的点，覆盖了 $1$ ~ $i$ 的叶子。

### [舌尖上的方伯伯](https://www.luogu.com.cn/problem/P3289)



### [水池](https://www.luogu.com.cn/problem/P6794)

### [$NOI2017-泳池$](https://www.luogu.com.cn/problem/P3824)

### [曼哈顿距离最小生成树](https://darkbzoj.tk/problem/2177)

连边 $O(n^2)$，然而和 $A$ 连边，只要把以 $A$ 为坐标原点的坐标系每 $45$ 度划为一块，每块选离 $A$ 最近的点连边，边数 $O(n)$

证明的话，考虑每块的 $y$ 和 $x$ 相对大小都是确定的，把绝对值拆开大力分讨就好。以 $45$ ~ $90$ 度这个区间为例，设该区域内有两个点 $B(x_1, y_1)$、$C(x_2, y_2)$，设 $AB \leq AC$，我们要证无论如何 $AC \geq BC$

$AB = x_1 + y_1, AC = x_2 + y_2$

1. $x_1 > x_2, y_1 > y_2$

    不满足 $AB \leq AC$.
2. $x_1 \leq x_2, y_1 > y_2$

    $BC = x_2 - x_1 + y_1 - y_2$

    $AC - BC = x_1 - y_1 + 2 * y_2$

    假设 $AC < BC, y_1 > x_1 + 2 * y_2$
    
    由于 $y_1 > y_2 > x_2 > x_1,$

    $AB = x_1 + y_1 > 2 * x_1 + 2 * y_2$, $AC = x_2 + y_2 < 2 * y_2 < AB$，矛盾
3. $x_1 > x_2, y_1 \leq y_2$

    与 $2$ 同理.
4. $x_1 \leq x_2, y_1 \leq y_2$

    $AB + BC = AC, AC > AB$

综上所述，$AC \geq BC$，根据 $Kruskal$ 的原理，$AC$ 永远不会被连上。

实际考虑四个区域就行了，因为边是双向的。方便的实现方法是把 $-90$ ~ $45$ 的点都翻到 $45$ ~ $90$ 里来。
$(x', y')$ 在以 $A(x, y)$ 为原点的 $45$ ~ $90$ 区域里，当且仅当 $y - x \leq y' - x'$，查询 $y' - x' \geq y - x$ 中 $x' + y'$ 最小的点就好了。把所有点按 $y - x$ 离散，按 $x$ 排序，树状数组维护。

出现了灵异事件——把结构体直接按照 $y - x$ 排序会错，而把 $y - x$ 拎到临时数组里再离散化就对了，人都调傻了，这是为啥啊？

[$Code$](https://darkbzoj.tk/submission/105321)

学习广义 SAM。

### [诸神眷顾的幻想乡](https://www.luogu.com.cn/problem/P3346)

模板题，从每个叶子出发建 Trie 树，在 Trie 树上跑 SAM，插入新点时看一下之前有没有。

### [找相同字符](https://www.luogu.com.cn/problem/P3181)

### [$CF666E-Forensic\ Examination$](https://www.luogu.com.cn/problem/CF666E)

建广义 SAM，预处理文本串每个字符在广义 SAM 中所对的位置，查询文本串 [pl, pr] 时就从 pr 所对的位置一只向上跳跳跳，跳到最后一个长度不小于 pr - pl + 1 的位置。广义 SAM 上线段树合并“来自哪个串”。

需要注意，因为是保留每个节点的线段树信息，线段树合并要把合并后的信息放到**新建节点**上。

### [$CF235C-Cyclical\ Quest$](https://www.luogu.com.cn/problem/CF235C)

---

一月到尾巴了，考完期末考了！

来学竞赛图。

### [世界是个动物园](https://uoj.ac/problem/451)

写在「【学习笔记】竞赛图」里了。