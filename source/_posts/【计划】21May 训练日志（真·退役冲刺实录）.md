---
title: '21May 训练日志（真·退役冲刺实录）'
date: 2021-05-31 23:59:59
tags: 
mathjax: true
encrypt: true
---

## $\mathcal{5.1}$

这几天都没有模拟赛诶 ε-(´∀｀; ) 这也太幸福了点

还有 10 天生日！

完球了完球了我被 la gloire à mes genoux 洗脑了 /fad

---

完球了 cmz 变化好大，果然比我高了 有 qy 前面那一惊吓（是真的吓人），再加上老友重逢，紧张得面红耳赤…… 算了让我去世吧

我靠我是他爸爸 镇定一点啊啊啊

完球了我草 我知道为什么我粉花花了 其中一个原因啊 是他有个神情和 cmz 特别像！！！

---

### EC Final 2019

单写

### 打了一场 GCJ

虽然 fst 大分了，但是还是晋级了。最后 5min 看着排名 1220 -> 1021 就nm爽。嘻嘻嘻嘻嘻嘻。

R2 是 21:00 ~ 23:30！还是 THUSC D1 晚上，刺激哦，打不打呢？

## $\mathcal{5.2}$

last two weeks from「Farewell OI」.

今天的任务是订完 EC Final 2019！学析合树，然后写两道 UOJ 爽爽~

upd：订了，没有完。析合树没学。UOJ 在调一道巨大恶心题。

## $\mathcal{5.3}$

### $UOJ312-$梦中的题面

巨大恶心。AC。

### [$CF865G-Flowers and Chocolate$](https://www.luogu.com.cn/problem/CF865G)

写在「BM」。

### 串串划分

写在学习笔记。

### 水题走四方

写在「UR」

### 去月球

建出操作树，$ans[l, r] = dist(pos[l - 1], pos[r])$，证明显然。

## $\mathcal{5.4}$

五四青年节！距离退役 11 天。上午模拟赛，一直犯困，脑子不清醒，sb DS 题都没想出来 气死我了。

### [暴躁的排序鸽](https://uoj.ac/problem/445)

快排干啥的：每层定参考点，将两边的元素关于参考点归类。相当于 $2$ 元排序器（每次将待分类元素和参考点排序），$O(nlogn)$

考虑改变参考点个数来优化复杂度。

每层若设 $a$ 个参考点，复杂度就是 $T(n) = (a + 1) T(\frac{n}{a + 1}) + \frac{n}{16 - a}$

模拟可得 $a$ 在 $6$ 左右时最优。

要记得 random_shuffle。

[$Code$](https://uoj.ac/submission/474311)

### [$IOI2018-$狼人](https://uoj.ac/problem/407)

chk 从 $S$ 到 $E$ 是否存在一条 $[L_i, n - 1]$ 再有个 $[L_i, R_i]$ 之间的点再一段 $[0, R_i]$ 的路径

最小和最大，分别建一棵 kruskal 重构树。那么算出人和狼的活动区域判交即可。

判交可以考虑 dfs 序，具体来说把小树的 dfs 序作为点的编号，在大树上做线段树合并，判断有无编号在某个区间内的点。

好像很码农。

还能离线 BIT？就直接找到人和狼的活动范围的子树，每个点的横纵坐标分别为其作为人和狼的 dfs 序，那么二维数点即可。

还是写写吧。

[$Code$](https://uoj.ac/submission/474034)

### [题目交流通道](https://uoj.ac/problem/279)

- 若所有 $d$ 都 $> 0$：
  - 若存在 $k$ 使得 $d_{u, v} = d_{u, k} + d_{v, k}$，那么贡献为乘上 $K - d_{u, v} + 1$
  否则贡献 $1$。

- 存在 $d = 0$:
  - $d = 0$ 的关系一定构成若干个团。缩团，然后相邻团之间有若干 $> 0$ 的重边就当作前面那种情况做。注意，不存在 $k$ 的情况，所有重边里至少要有一条边权为 $d_{u, v}$。

考虑团内部方案数，钦定一个子团内部任意点对距离为 $0$ 设为 $f_n$。将 $0$ 边视为有边，非 $0$ 边视为无边，就是求图连通的方案数，有经典容斥求法。

还要判无解？$d_{u, v} > d_{u, k} + d_{k, v}, d_{u, u} \neq 0, d_{u, v} > k, d_{u, v} \neq d_{v, u}$

[$Code$](https://uoj.ac/submission/474045)

### $XJOI1753$

#### $T1$

五边形数想起来了但来不及写了 数组开小了 /ll

竟然是道做法裂开的题，数据范围还略不合法（谁能 $n \sqrt{n}$ 跑过 $1e6$ 啊！）。

- $k = 0$：直接五边形数 $O(n \sqrt{n})$（不过暴力会 T 一个点
- $k = 1$、$2$，$p = 1$：
  - $k = 1$：使用奇数拆分
  - $k = 2$：使用模 $5$ 余 $1$ 或余 $4$ 的数拆分

  以 $k = 2$ 为例，$\prod \frac{1}{(1 - x^{5k + 1})(1 - x^{5k + 4})}$，其 ln 只有不超过 $\frac{n}{5k + 1} \frac{n}{5k + 4}$ 项，那么暴力求 ln 后 exp 即可。
- $k > 0$：背包 $O(n \sqrt{n})$ 比较显然。

#### $T2$

也不算完全 sb 的 DS 吧…… 应该有 1w 种做法。主席树就也可以。

官解给的是聪明做法：将区间看作一个区间 $A_i$ 挖掉一块区间 $B_i$，在二维平面上摆一条水平线段，横坐标范围是 $B_i$，纵坐标为 $i$，那么询问 $[l, r]$ 相当于找 $A[l$ ~ $r]$ 的交里最小的满足「竖直方向 $[l, r]$ 内没有点」的横坐标。扫描线即可。

#### $T3$

好像是人为钦定优先级，枚举填色，跑稳定婚姻算法。行吧

## $\mathcal{5.5}$

### $IOI2018-$机械娃娃

半·造自动机题。

一个触发器如果在 a 中出现两次以上且后继不同，就要开关。开关可以套开关！！

考虑不要每个点造二叉树了，就建一棵然后每个叶子节点指向下一个目标点。

深度为 $d$ 的满二叉树（为了保证最终所有开关状态为 X），共有 $2^d$ 个叶子，先经过的 $2^d - n$ 个点是空节点，指向根，后经过的 $n$ 个节点是触发点。

让子树里所有叶子都是空节点的节点指向根，点数就从 $2n$ 变成了 $n + logn$

关于细节：画个三层满二叉树观察一下发现走的顺序是按下标二进制位翻转后的位置来的，那么用 fft 中的 rev 数组即可。

[$Code$](https://loj.ac/s/1132171)

### 做了几道 prufer 题

写在「四种树的计数」

### [新年的小黄鸭](https://uoj.ac/problem/462)

考虑对每条重链找到叶子节点，然后在沿途打上标记。

sgt 维护 dfs 序区间 min。

log2 这个贡献可以用倍增，在每个 $2^i + 1$ 级祖先打标记计入贡献。

两只 log。

~~见鬼，写 + 调了一个半小时。~~

[$Code$](https://uoj.ac/submission/474188)

## $\mathcal{5.6}$

### $XJOI1754$

$T1$、$T3$ 300iq R2 $B$ & $H$ 不讲。~~（史上最短模拟赛题解）~~

$T2$：$f(n) = K * f(n - 1) - (K - 1) * f(n - L - 1) - [n == L + 1] + [n == 0]$。根据组合意义（走格子）可以枚举走了第二种方案几次，修正 $n = L + 1$ 的影响，那么复杂度是调和级数。

闲话：一开始，我：原题自动机竟是我自己，xml 也有今天！  后来：哦大家都找到了啊，那没事了。

### [新年的Dog划分](https://uoj.ac/problem/461)

询问：去掉一个边集，返回二分图是否连通。让你划分二分图。注意去掉的边可以不在原图中，因为你连原图长啥样都不知道。

假设当前已确定了左右部 $V1$、$V2$，考虑加点

首先如何找到与已知点相邻的点？二分未知点点集，恰好使图不连通的点必然与已知点相邻。$log(点集size)$ 次询问。

找到点以后判下与 $V1$、$V2$ 的连通性（注意返回的是**整个图**的连通性，因此连边要连以你二分找到的点为结尾的前缀）。若与 $V1$、$V2$ 都或都不相邻则 GG。

那么你会 $nlogn$ 了。

[$Code$](https://uoj.ac/submission/474257)

### 集训队作业2018-不可名状

单写

### 300iq contest 3

单写

### $XJOI1755$

#### $T1$

经 典 重 现

区间入栈弹栈 单点询问栈第 $k$ 项

如果求出个数就可以定位操作，考虑加进去的是若干个矩形，把 $[l, r]$ 分解为 $l$ 进 $r$ 出的一条通到世界末日的线段，线段树维护

怎么定位啊？考虑这个加减是连贯的，设当前个数为 $num$，找到最后一个 $num - K$ 的位置即可。维护区间 $min$ 若 $min \leq num - K$ 则走向那边（当然尽量往右走啦

#### $T2$

设 $p = \mu * \sigma_0^2$

$\sigma_0^2 = p * I$

令 $S(n) = \sum\limits_{i = 1}^n p(i)$，$S(n)$ 就是 $\sigma_0^2$ 的前缀和，也是我们要求的

$S(n) = \sum\limits_{i = 1}^n (p * I)(i) - \sum\limits_{d = 2}^n S(n/d)$，所以要能在根号复杂度内求出 $\sum\limits_{i = 1}^n (p * I)(i) = \sum\limits_{i = 1}^n \sigma_0^2(i)$（这步由简入繁强行杜教筛我也是佩服的）

$\sum\limits_{i = 1}^n \sigma_0^2(i) = \sum\limits_{i = 1}^n \sum\limits_{x | i} \sum\limits_{y | i} 1 = \sum_p \sum_q [(p, q) = 1] \sum\limits_{x = 1}^{n/p} \frac{n}{pqx} = \sum\limits_{T = 1}^n \sum\limits_{p | T} [(p, T/p) = 1] \sum\limits_{x = 1}^{n/p} \frac{n}{Tx}$

设后面这个 $= f(n/T)$, 前面那个 $= 2^{\omega(T)} = \sum\limits_{d | T} \mu^2(d)$，其中 $\omega(T)$ 表示 $T$ 的质因子种数

$\sum\limits_{i = 1}^n \sigma_0^2(i) = \sum\limits_{T = 1}^n f(n/T) \sum\limits_{d | T} \mu^2(d) = \sum\limits_{d = 1}^n \mu^2(d) \sum\limits_{T = 1}^{n/d} f(n/dT)$

设后面这个为 $g(n/d)$。

然后就做完了。

#### $T3$

数据出锅。orz

## $\mathcal{5.8}$

### $XJOI1756$

#### $T1$

SAM，线段树维护 parent 树上到根的链的 max。

#### $T2$

感觉是网络流（割哪条权值的边就是选哪个权值），但是一算，复杂度不对呀，$O(n^6)$…… 结果这就是正解……

#### $T3$

㗅的差不多了。链显然可以带权并查集（维护每个点到并查集根的异或和）+ 莫队（右端点递增，左端点移动范围长度只有 $\sqrt{n}$ 可以暴力插边暴力删除），没有想到的是并查集的根部还要放个线性基维护该并查集内所有环（我自己㗅的时候是用线段树维护线性基，然而处处受限= =），两个并查集合并时贡献的环权值，就可以用非树边的权值异或上两点到根的异或和计算。$O(n \sqrt{m} log^2V)$

upd: wh、cyb 说右边跑满而左边跑不满因此块长宜开大，wh 直接都开 $611$，然而我完全不是这样 = = 最后开了 $\sqrt{\frac{m}{2.7}}$

wh 教了一个比较（？）有效的卡常方法：一个基满了就不要再插了。

### [$ARC100F-Colorful\ Sequences$](https://www.luogu.com.cn/problem/AT4169)

神数数题？还好，都是基操但你就是想不出来……

我们记长度为 $k$ 的排列为 $k$-连续段。

题意：求存在 $k$-连续段 的所有方案中子串 $A$ 的出现次数和。

「存在至少一个」难算，考虑补集转化变为「一个都没有」。

称有 $k$-连续段 的序列为好序列。

$A$ 在所有序列中的出现次数和就是 $(n - m + 1) * k^{n - m}$. $A$ 在不好序列中的出现次数和怎么算呢？

1. $A$ 本身就是好的

    $0$
2. $A$ 不是好的
  - $A$ 有重复数字

    $k$-连续段一定不跨过 $A$。想到分别 dp 两边然后拼起来。
    $dp[i, j]$ 表示长度为 $i$ 的序列末尾存在一个 $j$-连续段 的方案数。转移 $(k - j) dp[i, j] \rightarrow dp[i + 1, j + 1], dp[i, j] \rightarrow dp[i + 1, k] (k \leq j)$
  - $A$ 没有重复数字

    就是数字不够了，过短。正常 dp，类似上面那种情况。

话说这同一个思路写两个 dp 就挺没意思的啊。

[$Code$](https://atcoder.jp/contests/arc100/submissions/22422048)

---

放假快乐！（一天，好多啊 QwQ）

---

---

现在颓废、做题抄题解就是给自己掘墓！

xml，变得更强些吧！

---

## $\mathcal{5.9}$

### 51nod1602

单写

## $\mathcal{5.10}$

生日倒计时一天 ε-(´∀｀; )

### $XJOI1757$

#### $T1$

概率不好搞。

考虑这个概率如何转化为「出现次数 / 总数」：就是你先写个排列出来然后抹去那些祖先在自己前面出现过的数，形成一个合法操作序列，合法操作序列出现次数被贡献了 $1$。

所以我们统计长度不超过 $k$ 的合法操作序列数然后除以 $n!$。

每个子树形成的操作序列是儿子子树的操作序列合并而成，根中间划一刀。

$dp[x, i, j]$ 表示 $x$ 子树的操作序列中，$x$（根）前面有 $i$ 个元素，其中 $j$ 个属于合法操作序列中的，方案数。

$O(n^4)$。

upd：$O(n^3)$ 的来了！简化了最后一维，就是带值进去算出点值然后插回来（或者 idft）。卡常恶心。

#### $T2$

外校小哥做出来了，小哥 nb！

好㗅细节多系列。写成环状，拿个指针指当前位置，本质是每次交换指针附近的两个。考虑必然存在一条分界线使得两边的 $0$ 走向不同。$ans = \max(lans, rans)$，$lans$ 和 $rans$ 一个单调不减一个单调不增，二分求 X 形函数交点。

#### $T3$

立马想到拆分贡献，求合法排列中括号对数后再分配标号。

同色括号对贡献就是 $Cat(n) * \binom{n}{2} * (n - 2)! * n!$，异色就烦了。

计算 )( 个数，() 的可以用总数减出来。

考虑两对括号对给 )( 的贡献：包含无贡献，相离贡献 $1$。

相离 = 总数 - 包含。

考虑包含怎么算：一对括号的贡献 = 它中间的括号对数

于是我们枚举中间的括号对数再插入到一个合法的括号序中就能算出来了：

$\sum\limits_{i = 1}^{n - 1} (2(n - 1 - i) + 1) i Cat(i) Cat(n - i - 1)$

（这里的 $n$ 默认除等于 $2$，$2(n - 1 - i) + 1$ 是在枚举位置）

动态维护 () 的个数嘛…… 根本不用 BIT 囧，因为 )( 和 () 个数的变化量就是 $|pos_r - pos_l|$。

## $\mathcal{5.11}$

祝 xml 生日快乐！！！

### $XJOI1758$

#### $T1$

wh：策略是走一段然后敲一个巨大钟然后往两边扩扩扩。最短路就好了。

然而实际上不发现这个性质也能做。降智……

$f[i, j]$ 表示从 $i$ 开始不超过 $j$ 步覆盖所有点的最小代价

对于每个 $[i, j]$，从近到远枚举决策，预处理往左往右扩展若干步以内到达 $1$/$n$ 的最小代价

自己写的时候降智了，不知道怎么处理「扩一端另一端也被迫扩」的情况，实际上可以看作换了个起点。

#### $T2$

就看着 qidashi 冲上来一顿「转置」「正交矩阵对角化」「矩阵最大特征值」就干完了。等题解了。

upd:

我还在想高消啥的，结果是线代，这……

我所不知道的线代知识：点 $x$ 投影在直线 $v$ 上的位置是 $x^Tv$

那么根据勾股定理，点到直线的距离就是 $|X|^2 - (x^Tv)^2$

于是问题转化为寻找一个单位长度向量 $v$ 使得 $\sum\limits_{i = 1}^n (x_i^T v)^2$ 最大

设 $A = (x_1, \cdots, x_n)$，那么就要求 $(Av)^T (Av) = v^T (AA^T) v$ 的最大值

由于 $v$ 是单位向量，我们只要找出 $(AA^T)$ 的最大特征值对应的特征向量即可。

有个 trick 就是选择一个初始向量，反复用矩阵左乘这个向量，它会逼近最大特征值对应的特征向量。实际上多 rand 一下也能模拟退火艹过去。

#### $T3$

是要做多项式因式分解和多项式复合。复合可以暴力，因式分解只能 berlekamp's algorithm（1967 年的老牌神仙算法，随便找了个[网址](http://www.diva-portal.org/smash/get/diva2:414578/FULLTEXT01.pdf)~~咕着~~，还有 [wiki](https://en.wikipedia.org/wiki/Factorization_of_polynomials_over_finite_fields) 上的什么有限域多项式因式分解）

## $\mathcal{5.12}$

祝 cbh（我哥）生日快乐！！！

### $XJOI1761$

#### $T1$

不同的染色序列可能得到相同的结果。为了不重，规定每个操作都是必要的序列是合法的，然后计合法序列。

官解是一个道理，只不过讨论的是「行不填满斜线区间」，大概好写一点？

对于每个斜线，不选它都会使一些行空出格子，预处理出每个斜线影响的区间 $[l_i, r_i]$，染行要求不能完整覆盖某个斜线的影响区间。

问题转化为，选一些区间然后在区间并里选行，不能有区间被选满。

注意到区间单调，可以 $dp[i, j]$ 表示第 $i$ 个区间选了最后 $j$ 个元素。

#### $T2$

hhz：诈骗题

显然当作形式幂级数考虑。$I$ 可以看作 $id_0$。

先只考虑 $id$ 卷

$f(p^c) = num_1 个 id_{a_1} * \cdots * num_k 个 id_{a_k}$

相当于把 $c$ 的次数分配给 $k$ 个函数，对于所有分配方案的系数求和。

那么最大次数显然是 $c$ 的次数全部给 $id_{a_k}$，即 $p^{c a_k}$，即 $n = c a_k$

$dp[i, j, k]$ 表示已经考虑了 $id_i$ ~ $id_m$，分配完了 $j$ 的次数，对 $p^k$ 系数的贡献。
记住还有个 $num$！要插板！

在每一位枚举确定分配次数，发现解是唯一的或者说近似唯一。$O(n^2c)$

最低位的函数不是 $id_0$ 就是 $\mu$，是 $\mu$ 怎么办？$\mu$ 相当于差分，$f(p^c) -= f(p^{c - 1})$

组合数还会重…… 官解说对于一个 $k$，$\binom{x}{k}$ 的值在模意义下最多重复 $3$ 次，对每种解都求答案

#### $T3$

$n = 2$ 可以容斥。$n$ 很大的时候——考虑正方形增长是一次的，求交是我二次的，求历史交之和是三次的。历史交和是个分段三次函数！共有 $n^2$ 段！只要每段插值插出来函数就好了。

为了获取点值要每段取三个时间点做扫描线。把正方形摆正了做。$O(n^3 logn)$

### [$CTS2019-$重复](https://loj.ac/p/3123)

有多少长度为 $m$ 的字符串的最小表示法的字典序小于 $s$。

I don't know string theory! 咳咳，瞄了眼题解。自动机。

先考虑检验算法：建立给定串的 KMP 数组，失配定义为所有 fail 指针的后继都比你大或整个等于你。

考虑 dp 套 dp: $dp[x, i]$ 表示到达自动机第 $x$ 个节点用了 $i$ 步的方案数

考虑检验算法的执行过程，我们只需要在自动机中建出「所有 fail 指针的后继最大值」作为当前的转移边。

容斥，总数 - 中途失配。$O(nm)$

[$Code$](https://loj.ac/s/1138262)

### [$ZJOI2018-$迷宫](https://uoj.ac/problem/375)

题意：令字符集为 $0$ ~ $m - 1$。称一个字符串合法，当且仅当将其看作 $m$ 进制数时是 $K$ 的倍数。

神仙题 ![uoj-bqb3](\images\uoj-bqb3.png) [zzd's blog](https://www.cnblogs.com/zhouzhendong/p/UOJ375.html)

先不考虑最小化状态。

首先 $n$ 可以等于 $K$。容易想到定义 $K$ 个状态 $0$ ~ $K - 1$ 表示当前距离和模 $K$ 的值。每个状态有 $m - 1$ 条出边。具体来说对于状态 $i$ 边 $j$，连边 $i \rightarrow (i * m + j) \mod K$

提一下，最小化状态数的暴力思想显然是不断合并等价点对，即转移后继相同的点对。就是缩点。

注意，$0$ 号节点的特殊性在于它是出口，不可以缩。

所以严谨的，到底什么时候可以合并/缩点啊？两个节点 $(a, b)$ 能被合并当且仅当 $\forall i \in [0, m), a * m + i \equiv b * m + i \pmod{K}$

令 $g = gcd(m, K)$, $K' = K/g$

$a \equiv b \pmod{K'}$

每个等价类 $g$ 个元素，因此 $n = K - (g - 1) * (K' - 1)$（模 $K' = 0$ 的不合并）

然而 boom 0？

还有二次缩点！毒瘤!

那么可合并的条件要改一改：满足 $a * m^u \equiv b * m^u \pmod{K'}$

等价类 size 变大了，个数变少了。$0$ 还是不能缩。而且前一轮没有被缩的点以后也不会被缩。

递归。$solve(r, m^u, K)$ 其中 $r$ 为剩下点数，$u$ 初始 $= 0$，返回值是减少的状态数。

[$Code$](https://uoj.ac/submission/475070)

### [$NOI2019-$I 君的探险](https://uoj.ac/problem/483)

探险！你看这个部分分给的这么有灵魂说明这是道「用肝换分」题（zzd 原话），实际上是做法裂开题

操作：点一下；询问状态；确定路径；判断是否确定完

三档互不包含：
- task 1 ~ 5：

  显然点一下问一遍。
- task 10 ~ 11：树，且不许 check：

  有性质 B 的保证，并且数据范围很显然是 $log$，考虑二分——单点 $nlogn$，就是二分然后 modify 前缀。那么整体二分即可。
- task 6 ~ 9, 12 ~ 25，剩余情况，以及性质 A：

  考虑性质 A，性质是一对的状态永远相同。随机选一半点 modify 然后归类 + 递归。

  考虑剩余情况，也还是随机选一半点 modify 然后看每个点的亮暗，亮就肯定和操作点集有连边，就进行归类然后递归。期望询问 $O(m log m)$。

[$Code$](https://uoj.ac/submission/475134)

## $\mathcal{5.13}$

### $XJOI1762$

#### $T1$

别贪心了…… dp 有前途…… 首先第一问 $dp_i = \min\limits_{a_{j + 1} \cap \cdots a_i \neq \emptyset}(dp_j) + 1$，第二问 $c_i = \sum\limits_{j, dp_j + 1 = dp_i} c_j * f(j + 1, i)$。按照 $dp_i$ 分段，每段的一个后缀对下一段有贡献。

$f(i, j) = \min(r[i : j]) - \max(l[i : j]) + 1$, 三部分分开来算。以 $\min(r)$ 为例，$i$ 前一段起贡献的那部分，一个后缀的 $\min(r)$ 是取自 $i$ 所在段，其余部分就是…… 做一个后缀和能维护的！贡献到前一段末尾就好！

$O(n)$，代码咕了

hhz 给大家重温了 xza 寒假讲过的 O(n) 支持前入后出和区间信息合并（两段合并成一段）但不支持单独删除（就是只有加法没减法）：维护 mid 指针，维护从 mid 开始向两边的前后缀信息和，尾巴弹弹弹直到碰到 mid 指针，然后就重构，把 mid 移到当前头部。

#### $T2$

考虑 $q$ 中大小为 $m$ 的环，在 $p$ 中会变成 $gcd(m, k)$ 个小环。设 $d = gcd(m, k)$, $g = m / d$。小环是确定的，那么考虑统计小环拼起来的方案数。每次找头部摆放位置，贡献是 $\prod\limits_{i = 1}^d (dg - jg)$，还要乘上分配标号的组合数。然而不太懂。

#### $T3$

最大权闭合子图模型显然。$k$ 小割以玄学的复杂度跑了过去【hhz 不屑.jpg】hhz：考虑这是个某些位置待确定的 01 串，从前往后确定，类 $k$ 短路，每个目标状态会浪费 $O(n)$ 次最小割，因此复杂度 $O(nk * 单次最小割)$，理论 $O(n^5)$ 实际玄学。

### [万圣节的积木](https://uoj.ac/problem/423)

从下往上放，已有 $1$ ~ $j$，那么 $j + 1$ ~ $i$ 放上去合法当且仅当 $\forall j \in [1, i)$, $j$ ~ $i$ 合法。按这个性质来，最优解是能拆则拆。

算重心，这…… 物理问题。带权重心公式：$\frac{\sum val_i * m_i}{\sum m_i}$。带入情境，$m_i = len_i = R_i - L_i$, $val_i = midpos_i = \frac{L_i + R_i}{2}$ 也就是说 $j + 1$ ~ $i$ 合法等价于

$$\frac{ \sum\limits_{j < k \leq i} \frac{L_k + R_k}{2} (R_k - L_k) }{\sum\limits_{j < k \leq i} R_k - L_k} = \frac{A_i - A_j}{B_i - B_j} \in [2L_j, 2R_j]$$

其中 $A_i = \sum_i (R_i^2 - L_i^2)$, $B_i = \sum_i (R_i - L_i)$

考虑所有 $1 \leq j < i$ 的 $j$ 都满足此式。化一下：以 $L$ 为例，$A_i \geq (2L_j)B_i + (A_j - 2L_jB_j)$，一次函数形式出来了，也就是说 $A_i$ 必须大于所有之前的函数在 $B_i$ 处的点值。李树加一次函数帮助 check。

[$Code$](https://uoj.ac/submission/475269)

### [快乐游戏鸡](https://uoj.ac/problem/284)

首先子树里 $w$ 比自己小的点可以忽略。那就是这么棵 $w$ 递增的树。

策略一定是，先拼命撞死然后一路走过去。准确来说，只要死亡次数小于 $\max\limits_{u \in Path(s, t)}(w_u)$ 就一直找最近的点撞死。

考虑预处理待撞序列。那么大概维护每个子树的待撞序列，$w$ 小深度大不优——单调栈！

相同深度只选最大的 $w$——深度相关！长剖。我悟了。

我们还想维护单调栈的前缀和 $\sum_i dep_i (W_{i} - W_{i - 1})$，但是单调栈只能维护后缀和…… fine，问题补大。

细节有点多：一个奇形怪状的单调栈，深度递增 $w$ 递增（这个还正常）支持合并，开头加元素（啊这！）——数组让你没有烦恼！何必同指针过不去。

[$Code$](https://uoj.ac/submission/475268)

### 新年的叶子

好㗅，其实挺简单因为**没有 ban 点操作**。设直径长为 $L$，若 $L$ 偶则直径一定过固定中点，否则一定过固定中边，那么把该边/点每个子树里深度为 $L/2$ 的点看作关键点，其余忽略。处理出每个子树的关键点集合。你会求一个集合被染黑的期望次数，那么现在要你求最多一个集合没被全部染黑。集合 S_i 的贡献是「其补集全部染黑的贡献和」-「它自己在补集全部染黑前黑完的贡献」。不写代码。

## $\mathcal{5.14}$

### [$APIO2013-$道路费用](https://www.luogu.com.cn/problem/P3639)

考察了…… MST 性质的熟练运用。

题意：选一个原边和新边组成的 MST，新边价格你定，原边价格为 0，要求 $maximize_{MST} ( \sum_{i \in Edge(MST)} c_i * \sum_j [i \in Path(j, 1)] )$

注意到 $k$ 只有 $20$，枚举被加入的集合，算出每条边被多少人经过，$O(2^k nm)$

可以不枚举吗？不行，完全没法聪明的确定新边哪些应该取。

那这个 $nm$ 感觉很费啊…… 你发现不同的新边边集，对应的最终方案中用到的原图边集变化不大

考虑缩小规模。新边尽量用，形成若干连通块，这时选原图尽量小的边把图连通（这些边是必选的）

将原图必选边缩点，形成 $k + 1$ 个点，再用原图另外的边跑这 $k + 1$ 个点的 MST，这次用到的边是给新边权值做参考的（新边要出现在 MST 中应当不比所在环上任何一条原图边大），也是有可能出现在最终 MST 的

那么再跑 $2^k$ 的枚举算法就是 $O(2^k k^2 + mlogm)$ 了。总之钦定一些新边必须选，连带着一些原图边必须选，你发现这复杂度对了那么问题就简单了，根据 MST 的性质计算边权即可。

[$Code$](https://www.luogu.com.cn/record/50647885)

### [$APIO2017-$斑斓之地](https://www.luogu.com.cn/problem/P3776)

我们称白点为非河流部分，黑点为河流部分。求连通块个数。

平面图欧拉公式：$C = V - E + F$，连通块数 = 点数 - 边数 + 划分平面数

$V$ 可二维数点数黑点然后减去，$E$ 要分横竖做。

$F$ 是啥啊？容易想到四个点都是白点的个数，依旧二维数点可做。**当矩形将蛇的路径严格包围（外面还有一圈白点）时面数要 +1**，如果没有严格包围那连通块长得是个若干环外面长很多杈子，严格包围就是紧贴着蛇路线的这圈其实围成了一个面。

离线线段树巨大蛋疼，你决定写可持久化线段树。

[$Code$](https://www.luogu.com.cn/record/50649288)

### JOISC 2021 最差记者

写在「JOISC 2021」

### 舌尖上的方伯伯

还是没写完…… 至少计算几何板子部分写掉了。不懂的是如何判 A、B 关于分割线对称。

### 游戏

似乎是板子题。~~我连板子都不会了啊啊啊~~

假设知道了每个点适合哪两种赛车，就可以 2-sat

$d$ 只有 $8$ 显然可以暴枚适合哪两种，不用三种情况因为正解一定存在两种情况满足。

$O(2^d n)$

[$Code$](https://loj.ac/s/1140147)

### 昨天 T3（k 短路）

### mx 的组合数

### mx 的仙人掌

和 cmz 摊牌了，好爽，就是后劲有点大，我现在抖的停不下来。不是我的心在抖，是潜意识的心在抖…… 毕竟快三年了，真挺失望的，不能忍受他来恶心我。

### THUSC 2021！

写了游记，玩得很开心w 接下来快乐 whk 啦！冲冲冲