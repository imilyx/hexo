---
title: '21Mar 训练日志'
date: 2021-03-31 23:59:59
tags: 
mathjax: true
encrypt: true
---

高中过去 1/6 啦！

## $\mathcal{3.1}$
---

### [$LG5577-$算力训练](https://www.luogu.com.cn/problem/P5577)

求 $\prod (1 + x^{a_i})$。直接做复杂度感人。考虑带单位根进去。那么 $\prod (1 + x^{a_i})$ 构成的数在集合 $\{ \omega_k^i + 1 \mid i \in [0, k) \cap Z \}$。集合很小，启发我们考虑每一种 $1 + \omega_k^i$ 的出现次数然后累乘起来。



代码咕了

### vjudge比赛

[链接](https://vjudge.net/contest/424925#overview) $B$ 写过

### $A$

套路题，把路线变成斜率为 $\pm 1$ 的直线，它经过横线/竖线的次数就是它横/竖方向改变的次数。算出最终方向，得出终点。~~然而 WA 爆了~~ 注意点是要取最小解！

### $C$

被打爆了 /kk 首先要读清题！~~我tm题目读错了可还行~~ 是问，有多少种数列使得不存在两个位置 $x < y$ 在删除了一些数位后 $a_x > a_y$ 且 $a_x$ 和 $a_y$ 在数位上相差位数 $> 1$。

首先考虑删除者的策略。从高位往低位考虑。设当前数位，第 $i$ 个数字值为 $a_i$。

1. 若 $a_x = a_y$，则当前位对 $(x, y)$ 无影响
2. 若 $a_x < a_y$，最坏情况下当然是删了这位
3. 若 $a_x > a_y$，则要「删不删都合法」，即 $x$、$y$ 更低位的数必须完全相同

dp，每次加一位。设 $f_{i, j}$ 表示 $n = i$, $m = j$ 的答案。若加的是 0000...1111，则直接从 $f_{n - 1, m}$ 转移；否则形如 00001xxx..xx01111，枚举 $x$ 的个数 $c$，则可由 $f_{n - 1, m - (c + 1)}$ 推得。前缀和优化至 $O(nm)$。

### $D$

先考虑没有 '?' 的情况。

考虑一个类 gcd 的过程：去掉开头相同的部分；剩下是 $A$/$B$ 分别开头的情况，一定有一个是另一个的前缀，假设 $A$ 是 $B$ 的前缀，将 $B$ 表示为 $A + C$。一直重复这个过程，容易证明 $(A, B)$ 合法当且仅当 $A$、$B$ 存在一个长度为 $gcd(|A|, |B|)$ 的公共循环节。那么只需要确定 $|A|$、$|B|$。

设 $cnt(s, a)$ 表示 $s$ 串中 $a$ 的出现次数。则 $cnt(s, A)|A| + cnt(s, B)|B| = cnt(t, A)|A| + cnt(t, B)|B|$，$(cnt(s, A) - cnt(t, A))|A| = (cnt(t, B) - cnt(s, B))|B|$

设 $a = cnt(s, A) - cnt(t, A)$, $b = cnt(t, B) - cnt(s, B)$

$a|A| = b|B|$。

- $a = b = 0$：莫反出解, $\sum\limits_{i = 1}^n \sum\limits_{j = 1}^n 2^{gcd(i, j)} = \sum\limits_{d = 1}^n 2^d \sum\limits_{d \mid T} (\frac{n}{T})^2 \mu(\frac{T}{d})$
- $ab \geq 0$：无解！无解！无解！
- $ab < 0$：取绝对值不影响结果。$gcd(|A|, |B|) = \frac{|A|}{\frac{b}{gcd(a, b)}} = \frac{|B|}{\frac{a}{gcd(a, b)}}$，即 $gcd(|A|, |B|)$ 最大可以取到 $\frac{n}{ \max( \frac{a}{gcd(a, b)}, \frac{b}{gcd(a, b)} ) }$，$1$ 到这个的每个数 都能作为 $gcd$ 被取到，所以答案就是 $1$ 到这个的 $2^i$ 的和。

有 '?' 的情况就是 $a$、$b$ 不确定了咯。设 $s$ 串有 $P$ 个 '?'，$t$ 串有 $Q$ 个 '?'，$f(a, b)$ 为 $(a, b)$ 的答案，则

$$ans = \sum\limits_{x = 0}^P \sum\limits_{y = 0}^Q f(a' + x - y, b' + P - Q - (x - y)) \binom{P}{x} \binom{Q}{y}$$

考虑枚举 $x - y$：

$$= \sum\limits_k f(a' + k, b' + P - Q - k) \sum\limits_x \binom{P}{x} \binom{Q}{x - k}$$

后者是 vandemonde 卷积形式，$= \sum_x \binom{P}{x} \binom{Q}{Q - x + k} = \binom{P + Q}{Q + k}$

**要特判两个串啥都相等的情况，因为之前把它当作 $a = b = 0$ 的情况算了，实际上它的答案是 $(\sum\limits_{i = 1}^n 2^i)^2$**

### $E$

从小往大，multiset 维护非空连续段，在 multiset 中最大值 = 最小值的时候更新答案。

## $\mathcal{3.2}$
---

### $B$

~~需要找一个 $0$ ~ $K - 1$ 都和 $K - 1$ 互质的 $K$。我与正解就差一个 $K$！！！心痛~~

根据 $K(K - 1) < n$ 可以算出 $K$ 的范围大概是 $[30, 40]$。第一行 $1$ ~ $K$，接下来 $K - 1$ 行第一位填 $1$，再 $K - 1$ 行第一位填 $2$…… 以此类推。考虑每个 $(K - 1) * (K - 1)$ 的正方形怎么填，第 $i$ 个正方形步长为 $i - 1$，这样从 $K + 1$ 出发就有 $K - 1$ 条不相交的链。容易证明每个正方形里的对和不同正方形里的对都满足限制。

好可惜好可惜好可惜，其实最后 $K = 5$ 的时候 checker 报错我执着的认为是做法错了，就已经心态崩了。。。仔细看看就知道是质数的问题了。可惜。

### $C$

枚举水量转化关系形成的连通块，显然对每个块分别考虑，最后来个 $3^n$ 的子集卷积

- 结论：设某连通块大小为 $k$，点权和为 $A$，边权和为 $B$，则答案为 $\frac{A - B}{k}$

- 一条边只走一次，点权大的点溢出，不断溢出吸收溢出吸收…… ~~证明不存在的，感性理解txdy！~~

要让边权和最小，就找 MST。复杂度 $O(2^n n^2log(n^2) + 3^n)$。

### $D$

考虑一定是先完全的割了一段区间的竖线或横线。接下来考虑先切竖线，横线类似。

假设开始切了 $(x, y)$ 区间的竖线，$f_i$ 表示切了 $i$ 及左边的所有线，$g_i$ 表示切了 $i$ 及右边的所有线，pre_i 表示 $[1, i]$ 上下都有人的线数，贡献就是 $2^{pre_{y - 1} - pre_x} * f_x * g_y = (f_x / 2^{pre_x}) * (g_y * 2^{pre_{y - 1}})$，加上前缀和优化。

考虑 $f_i$ 怎么求（$g_i$ 类似），设 $i$ 及左边部分，左边线数为 $x$，上面线数为 $y$，下面线数为 $z$，贡献是 $\binom{x + y + z - 1}{x - 1}$ 因为第一次必须切横线。

### $E$

完全没看懂。。。先咕了 [题解](https://zybuluo.com/Cyani/note/1779580)

## $\mathcal{3.3}$
---

[比赛链接](https://vjudge.net/contest/425291#overview)

### $A$

看成许多个山峰，盲猜一顿结论。

### $B$

吃饭的时候突然想到做法 把饭倒掉一路狂奔回来赶着最后 20s 交了然后 WA 了嘤嘤嘤——我和正解只差一个特判。。。我特判了没有 $0$ 的情况，但是只适用于 $n > 1$。。。

看成选一个位置、再选其一个相邻位置删掉的方案数。这么看是为了把 $\&$ 和 $|$ 拆成两种，且对于 11、00 组合显然适应，而对于 01、10 组合显然可以看作：先选 1 再选 0 为 $|$，先选 0 再选 1 为 $\&$。于是 dp 即可，$dp_0 = dp_1 = dp_2 = 1$, $dp_3 = 3$（手玩即可），$dp_i = dp_{i - 1} * (2 * (i - 3) + 3)$。最后枚举没删的 $1$，设其在位置 $p$，贡献是 $dp_p * dp_{n - p + 1} * \binom{n - 1}{p - 1}$。

upd：xza 更清晰的解释：$\{x, y\}$ 可以看成 $\{x | y, x \& y\}$。

### $C$

猎人杀本杀。根据期望的线性性，$B_i$ 在所有 $A_j$ 之前被删除的概率很好求，就是 $\frac{B_i}{B_i + \sum A_j}$。对于每个 $B_i$，要求其在所有 $A_j$ 之后删除的概率然后减掉。考虑容斥，枚举 $A$ 的子集 $S$，强制 $B_i$ 在 $S$ 之前被删。发现只和 $\sum A_j$ 有关，dp 即可，$dp_i$ 表示 $\sum A_j = i$ 的容斥系数之和。~~甚至都不用 TNT~~

### $D$

转置原理做多点求值的科技：[rqy讲得好赞！](https://rqy.moe/Algorithms/polynomial-evaluation/)

就是用求 $V^T a$ 的算法求 $Va$。

先考虑怎么用转置原理做简单的多项式乘法。把转置分解为初等矩阵乘积，从 $x += y * c \rightarrow y += x * c$ 理解为什么 $ans_{i + j} += a_i * b_j \rightarrow ans_i += a_{i + j} * b_j$，然后一遍减法卷积。

再来考虑如何做多点求值。考虑求 $V^T a$ 的算法：要计算 $\sum\limits_{j = 0}^{n - 1} \frac{u_j}{1 - \alpha_jx}$（$u$ 是输入的）。通分变成 $\frac{ \sum\limits_{i = 0}^{n - 1} u_i \prod\limits_{j \neq i} (1 - \alpha_jx) }{ (1 - \alpha_1x) \cdots (1 - \alpha_{n - 1}x) }$。

设分母多项式为 $g$，$g$ 可以分治 FFT。分子 $\prod$ 里的东西看作 $\frac{g}{1 - \alpha_ix}$。分子也是分治 FFT 求，每次返回 $ans_L g_R + ans_R g_L$。最后乘上 $g^{-1}$。

转回来，相当于把整个分治 NTT 反过来（当然分治计算 $g$ 是不变的因为它不属于转置部分啊啊）。对于输入的 $u$，先乘上 $g^{-1}$，再魔改分治 FFT 变成先计算 $ans_L = ans[保留一半] * g_R$, $ans_R = ans[保留 len - 一半] * g_L$ 然后分别把 $ans_L$ 和 $ans_R$ 向左向右递归下去。

此处卷积都是减法卷积，只需要后面一半，因此溢出到前一半也没有关系。只需要一次多项式求逆，常数比较小，据说可以跑 $5e5$。

### $E$

写在「LGV」。

## $\mathcal{3.4}$
---

所以今天就是订正了昨天的 CE？

### [$CF772D-varying\ Kibibits$](https://www.luogu.com.cn/problem/CF772D)

恰好，又是恰好……考虑统计 $F(x)$ 表示 $f(S)$ 至少为 $x$ 的贡献和，其实就是做六维后缀和。考虑平方贡献的合并，你要维护 $\sum y^2$, $\sum y$，以及 $\sum y^0$（表述可能不严谨，就是每一位都 $\geq x$ 的对应位的数的个数）。容斥回「恰好」，高维差分即可。[$Code$](https://codeforces.com/submissions/imily#)

## $\mathcal{3.5}$
---

学雷锋日快乐！

[比赛链接](https://vjudge.net/contest/425361#overview)

### $C$

先减去必须花费，剩下的可以做若干次大满贯即 $a \rightarrow b \rightarrow c \rightarrow a$，次数上限是 $up = (mxC - mustdo) / (c_0 + c_1 + c_2)$。设第 $i$ 个做大满贯 $b_i$ 次，必须做 $a_i$ 次，那么总次数就是 $a_i + 3b_i$。那么我们其实要在满足 $\sum b_i \leq up$ 的情况下算出每个 $i$ 刚好都是 $a_i$ 加上 $3$ 的倍数次的方案数。

考虑 dp，$f_{i, j, k}$ 表示做到第 $i$ 次，$j$ 个位置差一次，$k$ 个位置差两次，矩阵加速即可，$O(n^6 log 10^9)$。最后的 $(0, 0)$ 一定不超过 $mxC$，但 $(x, y)(x \neq 0\ or\ y \neq 0)$ 倒是有可能超过 $mxC$，不过这些位置用不到呀……

也有生成函数做法，单位根可以做到 $n^2 log n$：设 EGF $f_i(x) = \sum\limits_j \frac{x^{a_i + 3j}}{(a_i + 3j)!}$, 答案 EGF $F(x) = \prod_i f_i(x)$。

$$f_i(x) = \sum\limits_{j = 0}^{\infty} [3 \mid j - a_i] \frac{x^j}{j!} = \frac{1}{3} \sum\limits_{d = 0}^2 \frac{1}{\omega_3^{a_id}} e^{\omega_3^dx}$$

$$F(x) = \frac{1}{3^n} \prod\limits_i (e^x + \frac{1}{\omega_3^{a_i}} e^{\omega_3^1x} + \frac{1}{\omega_3^{2a_i}}e^{\omega_3^2x})$$

暴力展开 $3^n$，或者背包 $n^3$，得到系数，而我们只要前 $up * 3 + \sum a_k$ 项，等比数列求和即可。（分母乘上阶乘就没了呀 qwq）

$1e9 + 7$ 下似乎没有 $\omega_3^1$，要扩域。所以它好写个 der。

### $D$

仔细看 $n^2$ dp 方程，容易发现左端点只有 $log$ 段合法，可以树状数组维护每段后缀和。$O(n)$ 做法是维护前缀和……

### $E$

- $2K \leq n$：树一定是「糖果形」，即两端各挂子树，中间是条链，证明考虑从 $[1, k]$ 移动到 $[2, k + 1]$，$k + 1$ 一定和 $k$ 相连，不然在 $[k, k + k - 1]$ 这个区间就不连通了。子树要求父亲 $>$ 儿子，计数方法是 $tot! / \prod sz_i$，证明考虑归纳，在当前点 $x$ 有 $tot! / \prod\limits_{y \in son(x)} sz_y$ 种把编号分给每个子树的方法（就是多重集啦），每个儿子还要再分下去……不断除 $sz$。

- $2K > n$：$[n - k + 1, k]$ 随便排列，但是删除 $[n - k + 1, k]$ 后会裂成若干棵树，每棵树都要父亲 $>$ 儿子。发现重心一定在 $[n - k + 1, k]$ 里，每个点有三种选择：$[1, n - k]$, $[n - k + 1, k]$, $[k + 1, n]$，于是以重心为根做有依赖的树上背包。

## $\mathcal{3.6}$
---

[比赛链接](https://vjudge.net/contest/425847#overview)

~~无良 cly_none，讲课最水了。tc 网上又没什么题解，超级差评。~~

### $A$

构造，$n = 20$，从每个 $i$ 出发向后面的所有点和 $i - 1$ 连边，这样从 $i$ 出发到 $n - 1$ 的方案就是 $2^{17 - i}$，从 $0$ 向 $k$ 的对应位连边即可。

### $B$

如果是超时最大的，按 ddl 从小到大排序。现在这题只要移动一个任务，使得初始的最大任务变成次大任务、超时减少，这个任务变成最大任务、超时增多，$n^2$，每次更新答案。

这个任务一定在初始的最大次大任务之前（显然）。为什么不移动多个任务……自己画图讨论一下就知道了。

### $C$

排列的条件太啰嗦，缩为 $a_{i, x} - a_{i, y} = a_{j, x} - a_{j, y}$，再缩为 $a_{1, 1} - a_{1, j} = a_{i, 1} - a_{i, j}$，$a_{i, j} = a_{i, 1} + a_{1, j} - a_{1, 1} \geq 0$，那就可以抽出所有 $a_{i, 1}$ 和 $a_{1, j}$ 编为 $2(n - 1)$ 个点。已有数的连边 $x + y = v$（顺便判无解），形成若干连通块，一个连通块只要确定一个值就能确定剩余值。$\min_y(a_{1, y}) + \min_x(a_{x, 1})$ 应该 $\geq a_{1, 1}$，于是 dp，每个连通块枚举一个值（$a_{1, 1}$ 的上限只有 $18$），$dp_{i, j, k}$ 表示前 $i$ 个连通块，$\min(a_{x, 1}) = j$, $\min(a_{1, y}) = k$ 的方案数。

### $D$

RG、RB、BG 的个数固定，解出来分别设为 r、g、b。设 r > g > b。考虑在 r 之间插入 b 和 g，容易发现只有这几种组合：bgbg(gbgb), bgb, gbg，分别使得 b - g 的值不变、加一、减一，因此知道了 bgbg(gbgb) 的数量就能解出 bgb 和 gbg 的数量，枚举即可。~~细节好多~~ 可以先插 bgbg 和 bgb，再在剩下未确定类型的空隙中随便插入 gbg。

### $E$

写出 dp 方程: $dp_{i, j} = \max( dp_{i - 1, j}, dp_{i - 1, j - 1} + a_i * j )$

结论：存在一个 $k$ 使得 $j \leq k$ 时取前面，$j > k$ 时取后面。反证法，设 $F_{i, j}$ 表示 $dp_{i, j}$ 的位置集合。假设存在一个 $j$ 满足 $i \in F_{i, j}$ 且 $i \notin F_{i, j + 1}$，分类讨论大小关系然后可以证得矛盾。[详细点我](https://www.luogu.com.cn/blog/Mrsrz/solution-cf573e)

然后就是后缀加等差数列，平衡树/线段树维护即可。

## $\mathcal{3.7}$
---

### [魔法小程序](https://uoj.ac/problem/267)

发现它以 $a$ 为进制做了个高维前缀和…… 而数最大只有 $m$，$a$ 中大于 $1$ 的位置是 $log$ 级别的，直接高维差分即可。

### [连通子树](https://uoj.ac/problem/271)

数据好小…… 传说中不用脑子的题，但是代码很要脑子。$f_{x, i, j, k}$ 表示以 $x$ 为根的连通块，$a$、$b$、$c$ 个数分别为 $i$、$j$、$k$，由于每种颜色点只有 $5$ 个，可以直接每次询问建虚树，需要倍增维护虚链（随便选的方案的）dp 值。虚链需要维护三种方案：选择的链上点顶着下面、顶着上面、全选。

[感天动地的 $Code$，在洛谷上要吸氧](https://uoj.ac/submission/461253)

### [好图计数](https://loj.ac/p/6389)

写在「生成函数」。

## $\mathcal{3.8}$
---

### $XJOI1658$

#### $T1$

奇偶数——异或——线性基！对头。结果死在排序（优先级？）上了。比如：

````
110
001
(1, 2)
(-1, 3)
(1, 3)
````

这个按照 3、2、-3 显然不对，要按照 3、-3、2。

$3^n > 2 \sum\limits_{i = 0}^{n - 1} 3^i$，考虑每个基选不选，实际上只要考虑每个基的最高位。于是按照绝对值从大到小搞。

hhz：xor 起来

#### $T2$

$f_i = \sum g_{son, j}$，$g_j = \min(f_k + |c_i + k - j| * d_i)$，$f$ 和 $g$ 都是凸的，因为凸加凸还是凸，取 $min$ 也是凸，平衡树 + 启发式合并维护斜率；由于要输出方案，还要可持久化。

#### $T3$

强！zzy 点分真不戳，因为是减，所以点到分治重心的路径全部加长某个 $x$ 是不影响相互之间的贡献的。

$n log_{1.5} n$？/se，可以做到 $16$ 层。每层将子树从大到小排序，划为尽量平均的两份，一边置为 $-dep$，一边置为 $dep$，分治下去做；同一层之间可以通过给新边赋值来将该点更正为在该层应属的，即成为 $-dep$ 或 $dep$。

### 联合省选 2020

单写。

## $\mathcal{3.12}$

植树节快乐！

这大概是我周末作业干的最快的一周，周四晚上就写掉了（因为五六七都给竞赛辣！）物理卷子大题算对好评👌

### $XJOI1712$

#### $T1$

因为做过一些线头 dp 的题所以切了出来…… $L$ 向左跳，$R$ 向右跳，$dp_{i, j}$ 表示前 $i$ 个点形成了 $j$ 条 **结尾为 $R$** 的链，$L$ 可以缝合，$L$ 和 $R$ 都可以延长一条链，$R$ 可以单独形成链，$B$ 当作 $L$ 和 $R$ 分别做一遍。

~~被 hhz 叫上去讲了…… 大概没多少人写的是我这个又好想又好写的 $n^2$ 做法？orz hcy，他的做法我没懂…… 算是体验了一把「一顿操作猛如虎，回头一看二百五」的感觉~主要是 xml 紧张了 越说越快 o_o|||~~

~~dst: hcy 你不行~~ ~~希望 hcy 不会记恨于我！！~~

#### $T2$

LOJ6679。重链剖分 + 李超线段树合并，把一个询问挂在 $log$ 条链上。每个链开一棵李超线段树。直接插入 $log^2$。可以直接算整条重链，但是询问可能涉及到链的一个区间。线段树分治，把询问丢到线段树上该区间对应的位置。$O(nlog^3n)$

hhz: 你其实可以把一条线存在一个李超树的一个节点下，最后合并一次。来回都是 $log^2$，查询也是 $log^2$。~~还是写了 $log^3$~~

#### $T3$

我。。又双叒叕把 mul() 的返回类型写成 void 了。。丢 40 血亏

就用到了那个「第 $k$ 小的值的期望是 $\frac{k}{n + 1}$」。

积分？考虑直径的中心，将其两边的最大深度看作相等，设 $c_i$ 表示最大深度为 $i$ 的概率，$a$ 和 $b$ 分别为两边的，那么 $c_i = \sum\limits_{\max(j, k) = i} a_j b_k$。$c' = a'b'$。$c' = \int c$，就不停从下往上合并，然后不定积分搞？/kk，完全不会

### [$CF1439E$](https://www.luogu.com.cn/problem/CF1439E)

3500 诶!!! **完全不会。** 看题解。啊…… 妙哉

这必然是一棵树：首先它是个 DAG，然后 $(x, y)$ 只会和 $(x - 1, y)$ $(x, y - 1)$ 中的一个连（讨论一下奇偶）。又发现 $(x, y)$ 在树中的深度为 $x + y$。可以归纳证明 $(x, y)$ 的 sg 值为 $2^{x + y}$。后手想让初始时的 sg 异或和 $= 0$，即每个深度都有偶数个。那么后手的作弊操作相当于给初始 sg 异或序列的某个前缀异或 $1$，答案就是差分序列中 $1$ 的个数（所以每个操作是独立的qwq！）问题转化为求路径并，建虚树。

考虑加速求 LCA，$(x, y)$ 如果 $lowbit(x) < lowbit(y)$，要连续让 $x$ 减一 $2^{lowbit(x)}$ 次。**细节：求这种奇怪的 LCA 时只能「能跳则跳」，没有什么二进制距离加持，所以当「一个能跳、另一个不能跳」的时候，能跳的这个要跳上去，不然之后更小的步幅会出错。**

[$Code$](https://codeforces.com/contest/1439/submission/109833585)

---

## $\mathcal{3.13}$

### $XJOI1714$

#### $T1$

大力猜结论：答案是两倍的边权和 - $K$ 条边不相交路径最大边权和。$dp_{i, j, 0/1}$ 表示 $i$ 子树选了 $j$ 条路径，$i$ 是否有待匹配路径（显然 $i$ 如果匹配出去也只能匹配一条，所以这么设状态是正确的）树上背包合并，$O(n^2)/O(nK)$。~~我咋觉得难点是 dp 转移呢。。wqs 二分就套个皮子的事~~

瓶颈在于记录坐车次数。这玩意其实很像 wqs 二分有没有，选一个物品还带附加代价的！假设坐车代价 $C$ 不确定，发现坐车次数随 $C$ 增大而单调不增，于是类 wqs 二分的找到坐车次数恰好为 $K$ 的值，再把坐车代价更改为 $C$，单次 dp  $O(n)$。

#### $T2$

智商数学题！~~照着题解~~胡一下，「一条线段投影在某个方向上的长度比上它自身的长度」的期望 $= \frac{2}{\pi}$，选任何一条直线把所有线段映射到它上面的长度和的期望 $\geq \frac{2}{\pi}$，所以（？）我们就要去找一个不相交而且映射到这条直线上和原方案左右端点的方案，所以就是 $n$ 个黑点 $n$ 个白点做以欧几里得距离为边权的最大权完美匹配（根据三角不等式，一定不相交）。

现在要给这条直线找最佳角度。每条线段的映射长度等于 $len * \cos(\theta - x)$，分段凸函数，因此映射长度和是个分 $2n$ 段的凸函数，三分即可，$O(n^2logn)$。把 $\cos(\theta - x)$ 打开变成 $a \cos \theta + b \sin \theta$ 的样子，求导，极值点是导数为 $0$ 的，求导得 $a \cos \theta - b \sin \theta = 0$, $a/b = \tan \theta$，就得到了角度，去掉 $log$ 啦。

#### $T3$

对匹配串建 AC 自动机，对文本串建线段树，线段树每个节点上开一个数组 $f_i$ 表示 AC 自动机上初始点是 $i$，走完这个区间后到哪个点、匹配了多少次。

$f_i$ 倍增计算（按堆建树，长度就是 $2$ 的整数幂），维护 $f_i$ 的前后缀，单次修改 $\sum T_i log|S|$。

### $\mathcal{3.14}$

### [$LNR \#2$ 不等关系](https://loj.ac/p/575)

先不考虑 > 的限制，串长这样：<<<?<<??<<<<<?<，方案数为 $\frac{n!}{\prod len_i!}$。考虑容斥，$dp_i$ 表示考虑前 $i$ 个字符的合法方案数，$dp_i = [s_i = >] \sum\limits_{j = 0}^{i - 1} [s_j = >] (-1)^{cnt_{i} - cnt_j - 1} \frac{1}{(i - j)!} dp_j$ 即枚举最后一段、把其中的 ? 强制定为 <。分治 NTT 优化即可。~~代码咕了~~

### AGC 012

单写了

### 集训队作业

### 六省联考

### snoi2020 排列

### sdoi2017

### [新年的小黄鸭](https://uoj.ac/contest/48/problem/462)

### [快乐游戏鸡](https://uoj.ac/problem/284)

### CF1349D slime and biscuits

### cf1392H

---

## $\mathcal{3.19}$

### $XJOI1717$

zzy 的毒瘤 + 搞颜色场

#### $T1$

40 分还好想，**本质不同的凸包只有 $n^2$ 个**，预处理出来。你只要做到每次加一个点，维护链表，比如从左往右加点，从凸包上 $x$ 坐标最大的点开始往两边删，均摊 $O(1)$。

100 分是把凸包分成四块，这样就是极值点的事情了，预处理。以右上那块为例，枚举一个最右点，推一圈找到每个最上点，更新包含最右点和当前最上点的询问，这个二维前缀 max 即可。

#### $T2$

30 分是每次交换两个位置，将得到的新序列丢进堆，每次取堆顶。很暴力的想法，为什么没想到！？！？

#### $T3$

$C_i = A_i + B_i$。

$A_i + A_{i + 1} \geq a_i$, $B_i + B_{i + 1} \geq b_i$, 所以 $C_i + C_{i + 1} \geq a_i + b_i$

此外还有一个限制是 $C_i \geq c_i$。就这四个。

要 $\sum C_i$ 最小。考虑先构造 $C_i$，用 $type = 0$ 的方法。$C_1 = c_1$, $C_i = \max(c_i, a_{i - 1} + b_{i - 1} - C_{i - 1})$，感性理解就是当前的加一了后面的最多减一，不如不加。

$A_i$ 也用 $type = 0$ 的方法构造，$B_i = C_i - A_i$。

### [$Graph\ and\ Queries$](https://www.luogu.com.cn/problem/CF1416D)

把每条边删除的时间看作边权，没删的边边权为 $q + 1$，那么处理询问 $i$ 就相当于在边权 $\geq i$ 的边的导出子图中查询 + 修改，建出重构树即可。

### [$ZJOI2017-$线段树](https://loj.ac/p/2570)

如何定位 $[l, r]$ 对应的点？找到 $[l - 1, l - 1]$ 对应点（设为 $x$）和 $[r + 1, r + 1]$ 对应点（设为 $y$）的 LCA，$x$ 到 LCA 路径上所有有右儿子的点的右儿子，和 $y$ 到 LCA 路径上所有有左儿子的点的左儿子，就是 $[l, r]$ 对应的点。通过容斥和前缀和可以计算 $\sum\limits_{v \in S[l, r]} dist(u, v)$。

[$Code$](https://loj.ac/s/1094640)

### [$Unknown$](https://uoj.ac/problem/191)

考虑 $x_1 > x_2$ 且 $(x_1, y_1)$ 优于 $(x_2, y_2)$ 时，$\frac{S_y}{S_x} \geq \frac{y_1 - y_2}{x_1 - x_2}$，即切了上凸壳。

二进制分组维护凸壳，只是这回不是满了就合并——因为有删除。而是这一层的下一个点满了再合并，这样至少删除 $2^k$ 次才会有一次 $2^k$ 的重构。空间 $O(nlogn)$，时间 $O(nlog^2n)$。查询就在凸壳上二分。

[$Code$]($https://uoj.ac/submission/463954$)

## $\mathcal{3.20}$

### [$Port\ Facility$](https://uoj.ac/problem/356)

相交的线段对应点间连边，二分图染色判断是否存在解，答案 $= 2^{连通块个数}$。

考虑优化连边方式。首先三元环必不能存在。这样就保证了 $(1)(2)$ 不存在，那么就只有 $(3)$ 这种 $1$、$2$ 区间互相包含的形式了（$3$ 区间是当前处理的区间）：
```
111       111       11
 222     222       2222
  333      333       333
(1)       (2)       (3)
```
面对 $(3)$，我们将 $3$ 区间与 $1$、$2$ 区间连边，然后删去 $2$，直到之后某一时刻 $1$ 的右端点小于当前区间左端点时删去 $1$ 并加入 $2$。

所以将区间按左端点排序，对右端点维护堆，每个区间插入删除各一次。

但是不懂为什么空间要开两倍？？

[$Code$](https://uoj.ac/submission/464025)

### [$Sparklers$](https://uoj.ac/problem/357)

二分。不会了。……

编号在区间 $[i, j]$ 的人烟花燃过了，那么当前烟花正在燃烧的人所处位置在区间 $[x_j - s * (j - i), x_i + s * (j - i)]$。即如果 $x_j - x_i \leq 2 * s * (j - i)$，全往左和全往右两种极端情况可以覆盖 $[i, j]$，那么 $[i, j]$ 是可以全燃过的合法区间。

设 $b_i = x_i - 2 * s * i$。抽象一下，问题变成：有 $n$ 个点 $(i, b_i)$，初始有两个点在 $(k, b_k)$，每次可以选择一个点移动到左右的相邻位置，需要保证左边点始终高于右边点。贪心，从 $[k, k]$ 出发往外扩张，如果左端点可以在不小于右端点的情况下移动到左边更高的位置，就移，右端点同理。但是「抢占可达最高地和最低地」后离 $1$、$n$ 还有距离，怎么办？如果存在操作序列可到 $[1, n]$，那么反转该序列就是 $[1, n]$ 到当前位置，所以再从 $[1, n]$ 出发往里缩，看与扩张到的有无交集。

[$Code$](https://loj.ac/s/1095701)

### [$Magic$](https://loj.ac/p/6503)

让每张牌先带标号，最后再除掉，这样好算很多。恰好->至少，每种颜色单独考虑。

$f_{i, j}$ 表示处理了前 $i$ 种颜色，至少 $j$ 个魔术对的方案数。$f_{i, j} = \sum\limits_{k = 0}^j f_{i - 1, j - k} * val(i, k)$，这个 $val$ 是当前的贡献，可以这么计算：先选 $a_i - k$ 张，再将 $k$ 张牌一张张插入到已有牌间。$val(i, k) = \binom{a_i}{a_i - k} (a_i - k) (a_i - k + 1) \cdots (a_i - 1) = \binom{a_i}{k} \frac{(a_i - 1)!}{(a_i - k - 1)!}$

$f_{m, j}$ 还要乘上 $\frac{(n - j)!}{\prod a_i!}$ 才得到「至少」。分治 NTT 优化, $O(nlog^2n)$。

[$Code$](https://loj.ac/s/1096525)

### $XJOI1659$

#### $T1$

一只 $log$ 的三维偏序？？？

#### $T2$

考虑多项式固定的情况下如何求出 $1$ ~ $65536$ 的点值：直接代 $0$ ~ $65535$ 的单位根即可。

加个分块，定期重构，复杂度 $O(q \sqrt{65536 log 65536})$

#### $T3$

**自闭了**

1: 插板法

2: $f_{i, j} = [x^i] ( \frac{x^j}{(1 - x)^{2j}} ) = [x^{ij}] ( \frac{1}{(1 - x)^{2j}} )$，是个组合数的形式

3: $f_{i, j} = [x^i] ( e^x - 1 )^j$

4: $f_{i, j} = ( \sum\limits_{i \geq 1} \frac{x^i}{i} )^j = ( \sum\limits_{i \geq 1} \frac{ (i - 1)! x^i }{i!} )^j$，$(i - 1)!$ 是圆排列啊，于是就转为第一类斯特林数了。

5: 据说是[这题](https://uoj.ac/problem/420)的弱化版

## $\mathcal{3.21}$

### [$CF627E$](https://www.luogu.com.cn/problem/CF627E)

只会三方…… 正解好妙！！！枚举上边界 $i$，下边界从 $i$ 往下推，用链表以列为第一关键字、行为第二关键字维护区域内所有点。但是链表不支持随机访问，动态加点不可行。

但是链表支持删除！倒过来做，动态删点就可以啦。在删 $x$ 的时候统计进「以 $x$ 为最低点的矩阵」的贡献即可。删 $x$ 只会影响链表上 $x$ 的 $k - 1$ 个前驱，因此复杂度为 $O(n^2K)$。

[细节亿点多的代码](https://codeforces.com/problemset/submission/627/110590990)

### [$CF1491H$](https://www.luogu.com.cn/problem/CF1491H)

所有边都是从大往小指的，$O(\frac{q}{S} nlogn + qS logn)$，$O(qlogn\sqrt{n})$……？= = 啥呀这是，5.9e8 过不去吧。

正解：[别人写的很细了~~xml 你这么敷衍的嘛！~~](https://www.luogu.com.cn/blog/_post/316685)

修改：对于散块，直接修改；对于整块，如果修改次数尚且小于 $\sqrt{n}$，直接修改，否则 $pre_i = a_i$，直接记录 $a_i$ 移动距离之和即可。修改复杂度为 $O(块数 * \sqrt{n} * 单次修改复杂度) = O(n \sqrt{n})$。

询问：三种跳法，由于一个块只有 $O(\sqrt{n})$ 个元素，单次跳是 $O(\sqrt{n} + \sqrt{n} + \sqrt{n})$ 的（这个界还很松

[$Code$](https://codeforces.com/problemset/submission/1491/110607951)

### [$CF1492E$](https://www.luogu.com.cn/problem/CF1492E)

脑筋急转弯题……？

答案序列可以看作第一个序列 copy 一份然后改最多两处。无解情况：存在一个序列和第一个序列不同处 $> 4$。如果不同处全 $\leq 2$ 那显然找到解了。否则选一个不同处 $> 2$ 的序列，枚举改哪个（必然是三个不同的），然后判一判。至多递归两层，每层最多枚举 $4$，因此复杂度为 $O(4^2 nm)$。

### [$CF1325F$](https://www.luogu.com.cn/problem/CF1325F)

还是脑筋急转弯题，看 dfs 树，若某非树边连接的端点深度差 $\geq \sqrt{n} - 1$ 那么有环，否则一定存在大小为 $\sqrt{n}$ 的独立集，因为每个点至多连出 $\sqrt{n} - 2$ 条指向祖先的非树边，从下往上选独立集，一个点选了最多导致 $\sqrt{n} - 2$ 个不选，因此有解。

## $\mathcal{3.22}$

### [$Dark\ Horse$](https://www.luogu.com.cn/problem/AT3981)

你在哪都一样，不如放在 $1$。转化一下就是要每个 $[2^k + 1, 2^{k + 1}]$ 区间最小值都不是能打败你的危险人物。

只有 $log$ 个区间。从大往小放危险人物，$f[i, S]$ 表示从大往小放到第 $i$ 个人，放满了 $S$ 区间，最后乘一个阶乘安排完剩下的人。

### [$Student's\ Camp$](https://www.luogu.com.cn/problem/CF708E)

拼接起来的地方错了。小锅酿成大祸啊！！！总之就是刚了半天补集转化然而正解是正着来的。

考虑朴素 dp：$f[i, l, r]$ 表示 $i$ 行为 $[l, r]$ 的方案数

$$v[i] = \binom{T}{i} p^i (1 - p)^{T - i}$$

$$val[l, r] = v[l - 1] * v[m - r]$$

$$Val[r] = \sum\limits_{l \leq r} val[l, r]$$

$$f[i, l, r] = val[l, r] ( \sum\limits_{l', r' \leq m} f[i - 1, l', r'] - \sum\limits_{l', r' < l} f[i - 1, l', r'] - \sum\limits_{l', r' > r} f[i - 1, l', r'] )$$

显然后面两坨相等。

设 $s[i, j] = \sum\limits_{l, r \leq j} f[i, l, r]$

$$g[i, r] = \sum\limits_{l \leq r} f[i, l, r]$$

$$s[i, j] = \sum\limits_{r \leq j} g[i, r]$$

$$f[i, l, r] = val[l, r] ( s[i - 1, m] - s[i - 1, l - 1] - s[i - 1, m - r] )$$

$$g[i, r] = \sum\limits_{l \leq r} val[l, r] ( s[i - 1, m] - s[i - 1, l - 1] - s[i - 1, m - r] )$$

$$= s[i - 1, m] Val[r] - \sum\limits_{l \leq r} s[i - 1, l - 1] val[l, r] - s[i - 1, m - r] Val[r]$$

$$= Val[r] ( s[i - 1, m] - s[i - 1, m - r] ) - v[m - r] \sum\limits_{l \leq r} b[l - 1] s[i - 1, l - 1]$$

总之就是用各种前缀和的两维数组消掉三维数组。

注：代码中的 $f$、$s$、$g$ 与上述可能不同

### [$Choosing\ Ads$](https://www.luogu.com.cn/problem/CF643G)

主元素法推广，线段树每个节点维护 $k = \lfloor \frac{100}{p} \rfloor$ 个可能众数，若新加进个数等于其中某个，就将那个的次数 $++$，否则让所有众数次数 $--$。为什么这样正确？最多每次删 $k + 1$ 个数，这样删 $\lfloor \frac{n}{k + 1} \rfloor$ 次，而每个出现频率 $\geq p%$ 的数出现了严格大于 $\lfloor \frac{n}{k + 1} \rfloor$ 次。$O(K^2nlogn)$。[$Code$](https://codeforces.com/problemset/submission/643/110725194)

### [$Greenhouse\ Growth$](https://www.luogu.com.cn/problem/P4352)

思想很简单：链表维护不同高度的块。显然只会在初始时合呈 V 或 Λ 形的块才可能中途合并，计算好可能的合并时间，丢到做日程表用的 vector 里去。但是可能会有非常多的特殊情况，比如中途被合并了这块就没了…… 所以合并的时候还要判一大堆东西。[~~代码贺的~~](https://www.luogu.com.cn/record/48275005)

### ARC115 & CF709

单写了

## $\mathcal{3.23}$

### 六省联考2017

单写了

### [$CF1491G$](https://www.luogu.com.cn/problem/CF1491G)

~~2800 的构造题！/fad~~

为什么要看置换环？因为我们排列实际上是对于每个置换环在做排列。

通过先交换两个环的任意一对，两个置换环可以借助彼此来归位，次数是 $|s1| + |s2|$；但是最后剩下一个环怎么办？先交换一对使得其中一个在位置上，然后归位剩下的 $|s| - 3$ 个，然后还剩俩（$a$、$b$）位置不对、一个（$c$）操作次数不对，操作 $(b, c)$, $(a, c)$, $(a, b)$ 即可，次数是 $1 + (|s| - 3) + 3 = |s|$。总共是 $n + 1$。~~代码咕了~~

### [$COCI2019-Quiz$](https://www.luogu.com.cn/problem/P5308)

朴素 dp 方程：$dp_{i, j} = \max\limits_{k < i}( dp_{k, j - 1} + \frac{i - k}{i} )$

撇开第二维：$dp_i = \max\limits_{j < i}( dp_j + \frac{i - j}{i} )$。$(dp_j + 1)i - dp_i * i = j$，要 $dp_i$ 最大就是在 $0$ 处的截距最小，维护 $(dp_j + 1, j)$ 的下凸包。

套一个 wqs 二分，维护 $(dp_j + 1 - k, j)$ 的下凸包。

### [$CF321E$](https://www.luogu.com.cn/problem/CF321E)

写在「学习笔记」斜率优化、带权二分、决策单调性。

### [$Ynoi2011-$竞赛实验班/$loj517-$计算几何瞎暴力](https://www.luogu.com.cn/problem/P5312)

### [$UOJ430-line$](https://uoj.ac/problem/430)

写在「斜率优化 学习笔记」里。

## $\mathcal{3.24}$

### $XJOI1719$

xza 出的~~凉~~良心场。话说 xza 场的榜总是分布完美……

#### $T1$

首先答案一定是凸的。然后小观察，斜率最小的倒一下就变成斜率最大的，于是初始按斜率从大到小排序，依次决定插开头还是末尾，dp 再记录一维横坐标总和即可。

感想：有时候并不能直接思考得到切入口，这时不妨从几何角度啊代数角度啊多角度思考，曲折的得到结论。

#### $T2$

SAM？LCT 链上加维护最小值？两只 $log$。

一只 $log$ 就是——考虑离线，广义 SAM 加点就打标记，而**一个询问对应的是一段前缀的点**，所以最后从头开始沿着加点路径走一遍，把标记下推，顺便回答询问。

#### $T3$

好像很妙，设 $p_i$ 为前 $i$ 个位置修改次数和，那么 $p_i \geq p_{i - 1}$, $\forall i, j \in [l, r]$, $s_j + p_j - s_i - p_i \leq K$，$p_i \geq p_j + s_j - s_i - K$，就从 $j$ 向 $i$ 连 $s_j - s_i - K$ 的边，求最长路。

由于这是个 DAG，相当于选一些不交区间让代价和最小，这个可以用费用流做。设选 $i$ 个区间的最小代价为 $f(i)$，根据费用流的柿子，$f(i)$ 有凸性（因为每次增广增加的流量不会超过之前增广所增加的），这样就可以区间维护凸包，然后用斜率为 $K$（阈值）的直线去切（根据上面的转移柿子可知，每选一个区间就 $-K$）。凸包合并就闵可夫斯基。

### $AGC\ 013$

单写

我的草稿本像卷心菜叶子一样破！（迫真

## $\mathcal{3.25}$

今日计划：订正 ARC115-F 和 CF709-E、F，订正昨天模拟赛。做完了就去写 https://loj.ac/p/517 和 https://www.luogu.com.cn/problem/P2612 和 https://www.luogu.com.cn/problem/CF1237E 和 https://www.luogu.com.cn/problem/CF1227G 和 https://www.luogu.com.cn/problem/CF671D 吧！

### $XJOI1720$

互测日。

#### $T1$

两个串可以同时选，当且仅当它们的最小循环节不循环同构。

设 $f_L$ 表示长度为 $L$ 的无更小循环节的字符串个数，$g_L$ 为长度为 $L$ 的无循环节的方案数，$= c^L$。那么 $f_L = \sum\limits_{d \mid L} g_d$，莫反即可。

但——每种长度枚举一遍再莫反？炸了呀。看作高维前缀和，那么高维差分即可，$O(LlogL)$。

xYix 的线性做法：polya！（啊这，我想都没往群论想）

$$\sum\limits_{d \mid L} f_d = \frac{1}{n} \sum\limits_{i = 1}^n c^{gcd(i, n)}$$

$f$ 还是那个定义。这个等式左右都是长度为 $n$ 的本质不同字符串个数。

推柿子，反正怎么的可以 $O(n)$。我推不出来，放弃了。最后还是写了高维差分嘤

#### $T2$

注意！！一个左端点不只对应一个右端点orz，所以只能求后缀左端点 $min$，从右往左枚举 $R$，$L \leq R$ 的答案。

应该想到 $R$ 不变时，$f$ 是一个与 $L$ 有关的函数。把答案函数画出来你发现它是一堆折线：（如你所见，这里一开始胡成枚举 $L$ 了…… 然而不想改了）
```
                 -----------
                /
               /
         ------------------
        /    /
       /    /
      /    /
     /    /
    /    /
   /    /
  /    /
 /    /
/    /
l1  l2  r1      r2
```

斜率为 $1$，一条线保证到达其最终高度，所以求并集面积非常方便。只有第一块面积要分类讨论一下，单调栈即可。

#### $T3$

论文题，隐式后缀树板子题？我不会呀。赛时写了 $25$ 分的广义 SAM + PAM。

---

## 今天的计划应该是——

今天任务：然后去写清训题，再去写 thupc 题，晚上 vp AGC

做 CF 好题呀！

<!-- 今天任务：学拟阵 + 保序回归（） -->

LOJ154!!!
写转置版多点求值
thupc、thuwc
清华集训（选）感觉题质量不是太好
loj6295（线性规划）
uoj448
生成函数：LOJ3102 luogu5577 数树 普通转下降幂
集训队作业：化学竞赛
写 exgcd 总结（通解）




---
Gym 入坑指南：（勿删！有 xza 课件外强推场次）

可看星级

ICPC：
- EC final 18(jiry_2)、19(xudyh)年
- 日韩赛区的 ICPC
- 欧洲的 NEERC、NERC、CERC(15~17)
官网找题解

official international personal contest:
- yandex.algorithm
    2018 final round
    以及一些 qualification round
- russian code cup
- facebook hacker camp
- google code jam
    final

school/university/city/region championship
- CCPC
    分站赛
    final(18、19)
- 多校

opencup contest & training camp contest
- moscow workshop
    https://discover.it-edu.com/en/
- petrozavodsk camp 毛营题
    有一些科技
- open cup
题解找google

看讨论？也许有题解

opencup 里推荐的
- XXI opencup gp of tokyo
- XX opencup gp of tokyo
- XXI korea
- 2019 ICPC asia east continent final
- 300iq contest 1 ~ 3
- rng_58 (14、15) 毛营
---