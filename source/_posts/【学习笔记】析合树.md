---
title: '【学习笔记】析合树'
date: 2021-04-14 20:10:40
tags:
    - 学习笔记
    - 析合树
mathjax: true
---

upd on 2021.9.1: 重学。

## 一些定义

- 本原连续段：又称本原段，不存在另一个连续段与其相交却不包含的连续段，可以理解为**极长连续段**。每个连续段都由若干不交的本原段组成。
- 析合树：排列 P 的析合树由 P 的所有本原段组成。
- 儿子序列：该序列元素为每个儿子的值域区间。
- 儿子排列：将儿子序列离散化后的排列。
- 合点：儿子排列为升序或降序的点。特别的，**叶子为合点**。
- 析点：非合点。

## 一些性质

- 合点儿子序列任意子区间都构成连续段。显然。
- 析点儿子序列任意**长度大于 1 的子区间（指儿子个数大于 1 而非下标长度大于 1）**都不构成连续段。

  反证：若存在构成连续段的情况，取极长连续段，它满足本原段的定义但是析合树中没有它，与「析合树由所有本原段组成」矛盾。
- 析点至少有 $4$ 个儿子。显然。多用于计数。

## 计数

感觉析合树计数相对于造析合树题更多啊……

析合树的计数，只要会容斥都没啥大问题，极长本原段还是很好容斥的嘛：

$$
g_i = i! - \sum\limits_{j = 1}^{i - 1} g_j (i - j)!
$$

于是合点就很好处理了。

析点直接数没法数的，需要用儿子排列的析合树算「儿子排列极长连续段长度不超过 $1$ 的序列」再随便分配。设 $f_i$ 表示 $i$ 个数的极长连续段长度不超过 $1$ 的序列个数，$f_i$ 可以用「总数 - 根为合点方案数 - 根为析点但儿子个数 $\leq i - 1$ 方案数」来求：

$$
f_i = i! - 2 \sum\limits_{j = 1}^{i - 1} g_j (i - j)! - \sum\limits_{j = 4}^{i - 1} f_j G_{i, j}
$$

$G_{i, j}$ 表示将 $i$ 划为 $j$ 个连续段的方案数。

于是 [纯洁憧憬](https://www.luogu.com.cn/problem/P7278) 这种板题随便乱杀。

## 构建析合树