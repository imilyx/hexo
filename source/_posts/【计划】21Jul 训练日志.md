---
title: '21Jul 训练日志'
date: 2021-07-31 23:59:59
tags: 
mathjax: true
encrypt: true
---

学考考完力，快乐丢三门 ~ 家徒四 B 预定

规划暑假！

- 《数学竞赛研究教程》
- 《我怎样解题》
- 语文：唐诗宋词鉴赏词典 + 阅读；英语：听、读

- CF 上紫（先定个小目标？）除此之外每场 AT 和 UOJ 必打

打算康复训练做一点坑着的题。然后可以板刷 CF 2500~2800 什么的。

## $\mathcal{7.5}$
---

### $XJOI2735$

#### $T1$

神仙题。结论：必败态为「123相同，567相同，145异或和为 0」。证明：首先最终状态符合。然后每个必胜态都能到达必败态（设 123 最小为 x，567 最小为 y，除 x、y、4 外全选，x、y、4 选最大，就向 nim 游戏那样操作）

那么必败态种类就可以 dp 求，f[i, 0/1, 0/1, 0/1] 表示当前到第 i 位，123 是否到上界，4 是否到上界，567 是否到上界。

### [$JOISC-$女装大佬](https://loj.ac/p/2734)

写在「JOI」。

## $\mathcal{7.6}$
---

xml 啥也不行，好难过。

接下来要好好打算呢，毕竟是真的最后一个假期冲信奥了。

### [mx的仙人掌](https://uoj.ac/problem/87)

就在圆方树上用方点圆点建虚树呗，然后 dp 求直径。

我是将圆点向对应方点连的边的距离定为「圆点到当前点双（环）的最浅点的距离」。

求直径的时候不是以每个点作为 LCA 合并两条链嘛，当前点若是圆点那没有关系直接合并，否则要算两条链的链顶在环上的距离，单调队列即可。

$O(nlogn)$。

[$Code$](https://uoj.ac/submission/482788)

## $\mathcal{7.7}$
---

我只想说…… 撇去模拟赛，OI 还是很令人偷税的！

今天模拟赛直接 10 分滚粗，听完 hhz 的讲评感觉我又可以了！（指对 OI 的热情恢复 50%（嘛，只有 50%？唉慢慢来吧

明出舰b科研四期！！！安克雷奇 /qq【几个菜啊你科技点不够

### $XJOI2737$

#### $T1$

按位确定在脑海中一晃而过。实际上是可以的。

令答案「更低的待确定位」默认为 $1$，看每个数要成为答案的子集最少需要删几位，并把这个信息存在桶里，若有偶数个就进位。只要 $bin[0]$ 不是空的就行。这样就不用担心系数和 $= 1$ 的限制了！进位完，非 $0$ 位上剩下的东西用操作二删掉即可。并且这个东西满足一定的单调性，确认位较少的时候，删的位较低，容易到达 $0$ 位。

$O(nw^2)$，只有 $35$，优化没听懂……

upd：题解出来了 /tyt 明白了！

找「至少挪几位」要 $O(w)$，太费了。

考虑对每个数 $a_i$ 都维护一个二进制数 $b_i$，第 $t$ 位表示当前已经确定了答案这么多位，$a_i$ 右移 $t$ 位是否是已确定答案的子集。

考虑这样答案当前位（设为第 x 位）取 $0$ 对这些 $b_i$ 的影响：
- 第 $x + t$ 位若为 $1$，则 $b_i$ 中第 $t$ 位 $0 \rightarrow 1$, $1 \rightarrow 1$
- 若为 $0$，则 $b_i$ 中第 $t$ 位 $0 \rightarrow 0$, $1 \rightarrow 1$。

即：$b_i |= (a_i >> x)$。

#### $T2$

题读清：**若干**次行走。

首先某个串如果存在 ABA 的子串，即两个相同字符中间只隔一个字符，这个串就是「配得上丹」的（呕这太中二了，我们还是称其为好串吧……

为什么？若该串形如 $S_1 A_1 B A_2 S_2$，可以走 $A_1 B A_1 \hat{S_1} S_1 A_1 B A_2 S_2 \hat{S_2} A_2 B A_1 \hat{S_1} S_1 A_1 B A_2$

判掉这种情况。接下来讨论不存在奇回文串的情况。

判断串是否好，等价于判断某个点能否被合法的偶回文串覆盖

首先判有无空档（有无串没被偶回文串覆盖）

无空档的话，从最终方案里覆盖它的回文串中拆出以它为端点的子回文串的端点不能超出 $[L, R]$

这两步构成充要条件。

形式化的，无解条件：

$\exists i \in [L, R]$, $L \in (i - lef_i + 1, i] 或 R \in [i, i + rig_i - 1)$

是个矩形，扫描线即可。

$lef_i$ 和 $rig_i$ 显然是两个方向上 $i$ 到最近的覆盖 $i$ 的回文中心的距离，单调栈即可。

#### $T3$

首先环大小 $> 2$ 的可以拆成若干个二元环，显然不亏。那么度数都为 $1$ 就是二分图最大匹配了。

考虑成二元环的条件：$i \leq b[j]$, $j \leq a[i]$

（画在平面上比较直观，$(i, a[i])$, $(b[j], j)$，前者连边范围是一个 $\frac{1}{4}$ 平面）

贪心匹配即可。你甚至都不需要模拟费用流建模。

### [$LOJ6240-$仙人掌](https://loj.ac/p/6240)

神仙题啊……

贡献转化为每个点的「生存时间」期望之和。

每个点 $x$ 的生存时间等价于「其他点 $y$ 在死亡前都与其相连的概率乘上 $y$ 死亡时长（即 $1$）」之和

记 $y$ 对 $x$ 的贡献为 $p(x, y)$。只要 $y$ 是 $Path(x, y)$ 上最先死亡的就行了。

树用脚做——$p(x, y) = \frac{1}{dist(x, y)}$

仙人掌捏？$x$ 到 $y$ 经过若干环和圆点，在 $y$ 死亡前，圆点一个都不能死，且环会被 pia 成两半，两半不能同时断开。

只能枚举在 $y$ 之前死了几个啦！$dp_i$ 表示在 $y$ 前死亡的集合 $size = i$ 的方案数，$tot$ 表示 $x$ 到 $y$ 路径上的环点数和。

$p(x, y) = \sum\limits_{k = 0}^{tot - 1} \frac{1}{k + 1} \frac{dp_k}{\binom{tot}{k}}$

$n^3$ 在圆方树上求 $dp_k$。设 $tmp[x, k]$ 表示当前点双走过了 $x$ 个点，选的点加上以前点双选的点个数为 $k$ 的方案数，然后设点双（环）上两个点距离为 $dis$，方案就是 $tmp[dis, k] + tmp[size - dis, k] - 当前点双不选点的方案数$。

[$Code$](https://loj.ac/s/1174878)

### [$APIO2016-firework$](https://loj.ac/p/2568)

题意非常简单：使得所有点到根的距离相等，要求改动尽可能少。

啊…… 好像是某 XJ 模拟赛题的弱化版（没订正的那种！），那题修改代价还要乘一个系数

特性肯定和「代价是 abs 函数」有关。然后就啥也不会了，躺平.jpg

$[L, R]$ 为 $f_u(x)$ 斜率为 $0$ 的部分

- $x \leq L$：$f_{fa_u}(x) = f_u(x) + w$，即删掉 $w$，因为从斜率上看显然 $f_u(x - w) \geq f_u(x) + w$
- $x \in [L, L + w]$：$f_{fa_u}(x) = f_u(L) + w - x + L$
- $x \in [L + w, R + w]$：$f_{fa_u}(x) = f_u(x - w) = f_u(L)$
- $x \geq R + w$：$f_{fa_u}(x) = f_u(R) + x - R - w$

就是把 $[L, R]$ 往右平移，$[0, L]$ 往上平移，留下两个裂口，左边那个加一条斜率为 $-1$ 的直线，右边那个加一条斜率为 $1$ 的直线

按套路维护函数就维护斜率变化点集。很恶心的是这个斜率 $-1$ 的线，可能会抵消一部分斜率变化点。

不如用多重集，每个元素出现的次数代表该分段函数斜率，$L$ 以前的表示斜率 $-1$，$R$ 以后的表示 $+1$。

第一阶段斜率变化点照抄，第二阶段发现将多重集里的 $L$ 删掉一个即可，第三阶段新增 $L + w$，第四阶段新增 $R + w$。

要知道是 $-$ 还是 $+$ 得知道 $L$、$R$ 是啥，怎么找 $L$、$R$ ？弹掉斜率最大的 $deg - 1$ 个变化点就行了（为什么自己想）

考虑计算答案，用 $f_1(0)$ 加上（实际上是减去）变化点集中 $L$ 及其以前所有变化点的贡献即可得到 $[L, R]$ 的值。

[$Code$](https://loj.ac/s/1175144)

### [$APIO2016-$划艇](https://loj.ac/p/2567)

离散化，只有 $O(n)$ 个值域区间（左闭右开，所以右端点要加一再丢到离散化数组里）

$f[i, j]$ 表示 $i$ 选择了第 $j$ 个值域区间。最终选择的值域区间一定是往高走的，而且是分段的。

$f[i, j] = \sum\limits_{k, l(l < j)} f[k, l] * ( \sum\limits_{i = 1}^{num} \binom{len}{i} \binom{num - 1}{i - 1} )$

后面这坨范德蒙卷积形式啊，$= \binom{len + num - 1, num}$

$len$ 是 $j$ 这个值域区间的长度，$num$ 是可以塞到 $j$ 区间里的最大连续段长度

[$Code$](https://loj.ac/s/1175701)

## $\mathcal{7.8}$
---

科研四期！！！安克雷奇！！！【i i 狂粉】

upd：在学校上不了舰b。看了下某吧，彩科研上限未知，甚至出现了半小时彩定向 11 张的好成绩！！心动。

**分流启动**，qy（和 xy）将我归为冲约一类。也不错啊对我这样「啥都行」但和竞赛情未了的人来说。接下来就基本是专心提高 OI 水平了。

### [$APIO2020-$有趣的旅途](https://loj.ac/p/3347)

度数最大为 $3$ ！！！

考虑知道树的形态了怎么做。「每个点出现一次」暗示了经典模型：有 $sum$ 个物品被划分为若干集合，每次可选两个不同集合的物品匹配并抵消。将子树按最大深度从大到小排，从最深点出发，跳到次深子树，再跳回最深子树，如此反复。显然只要不存在一个子树 $size > n / 2$ 就可以消完。

所以应该选重心作为根。在 $mx * 2 < tot$ 时我们优先选深的。在 $mx * 2 = tot$ 时我们开始要每条边都经过 $mx$ 了。

如何找重心？以 $1$ 为根 $n$ 次询问每个点的子树大小，子树大小 $\geq n / 2$ 且最小的就是。

再 $n$ 次询问每个点的深度。接下来只要把每个点分到三个子树里去就好了，询问共 $2n$ 次。

[$Code$](https://loj.ac/s/1176261)

### $XJOI2741$

#### $T1$

询问一个区间所有子区间。询问可以分治啥的，考虑单个区间怎么求。

考虑类序列自动机，$S_1$ 中每个位置向后连字符集大小条边，显然只有一条边是连向紧跟自己的那个位置，其余都连到接下来的串中第一次出现目标字符的位置。于是可以矩乘。

可以 yy 这样是对的，因为 $n = 2$ 时不会出现 $abca|bc$ 和 $abc|abc$ 同时对答案产生贡献的情况（$S_1$ 中的 $c$ 连出的 $a$ 边只会到达一个位置），推广到 $n > 2$ 显然也是对的。

矩阵 $[a, b]$ 存当前串 $a \rightarrow c \rightarrow b$ 的路径数。

由于 $f(l, r) = B * A_l * D + B * A_l * A_{l + 1} D + \cdots + B * A_l * \cdots * A_r D$，
我们必须设一个累加位

矩乘可以这么设计：$B[1, T + 1]$, $A[T + 1, T + 1]$, $D[T + 1, 1]$，$B$ 全为 $1$，$D$ 第 $T + 1$ 个位置为 $1$，$A$ 最后一列为 $1$

$B$ $1$ ~ $T$ 列为，当前结尾字符为 $i$ 的串个数，第 $T + 1$ 个位置起累加作用

总结来说正确性由「连向之后最近的那个字符」保证。

#### $T2$

所以这题的难点就是求 把 $a$ 划分为 $b$ 段的段长乘积和。$1e7$ 级别。$n^2$ 可以优化得到。

正解：划分段和求乘积和都很毒瘤，但是合在一起就很好做…… 考虑它就是求方案数的，共选 $2 * 白点个数$ 个，那么除去白点的那些也视为白点，一个组合数然后偶数位当作白点就可以了。

#### $T3$

看题解。各种反证就不多说了，说些实现细节…… 大约是 xml 完全笨掉了罢

对每个块维护其白点集合，黑白点个数，再用两个全局集合 $s1$、$s2$ 维护每个块的最小白点，具体来说：

- 该块只有一个白点：$s2$
- 否则 $s1$

合并的时候，合并白点集合，黑白点个数相加（减去配对的），$s1$、$s2$、白点集合删去配对的白点。如果合并后只剩一个白点，就从 $s1$ 转到 $s2$。

发现神奇的事情：集合 s 中没有元素 x 的时候 s.erase(x) 不报错！！！保险起见还是不要这样。

#### $T3$

## $\mathcal{7.9}$
---

### $UR21-$挑战最大团

写在「UR」。

### $APIO2014-Palindromes$

写了 PAM 版本，简直无脑。

### [$APIO2021-$雨林跳跃](https://loj.ac/p/3530)

你需要大力猜结论！

无解：$[B + 1, C - 1]_{max} > [C, D]_{max}$

设 $[B + 1, C - 1]_{max}$ 坐标为 $x$，$[C, D]_{max}$ 坐标为 $t$

起点 $s$ 应该满足 $[s, x - 1]_{max} < h_t$，且 $h_s$ 尽可能大

接下来有两种走法：
1. 我们知道，位于 $[h_x, h_t)$ 时，一步可达，因此尽快达到「走一步进入 $[h_x, h_t)$」的状态，然后走两步到 $t$。也就是说在跳跃的过程中保证高度一直 $< h_t$ 时，尽量往高走（类似 JOI-火车旅行）最后右边一马平川，无脑向右跳即可到达 $t$。
2. 一直都没进入 $[h_x, h_t)$ 也是有办法上岸的！终点不是 $t$ 的话，只要落到 $[C, D]$ 这个坐标范围里也合法。

两种取 min。

你需要维护哪些倍增数组：往左/右跳，往高走，最大高度。

[$Code$](https://loj.ac/s/1177954)

---

JOI 数据结构好多啊 /流汗黄豆 DS 虽好，不能全写 DS。无脑题少搞！

---

### JOI-帐篷、道路建设

写在「JOI」

- 模拟赛尽量订正
- 板刷 CF 2500+
- 专题复习（借 UOJ 和 LOJ 和 CF 的标签功能）
- 打 CF、AT、UOJ 比赛
- 保留一些自由调整的空间

我是觉得啊康复训练先加大自由调整的比例，多看博客和复习专题。**时不我待，快点康复。**

另外：
- 缩减博客精致度（题解还是要讲清楚的。）
- 少看题解
- 追求质（指独立思考）而不是量
- 学 JS 的计划只能搁置了。

## $\mathcal{7.10}$
---

### $XJOI2746$

#### $T1$

显然 $s[p[i]] \leq s[p[i + 1]]$，问题就在是否取到等号。

如果 $[p[i] + 1, n] > [p[i + 1] + 1, n]$，那么只能指望 $s[p[i]] < s[p[i + 1]]$ 了。

于是我们得到一个链状的偏序关系，$<$ 可以通过 $-1$ 变成 $\leq$。如何填数？二分即可。这个决策单调性你怎么看不出来呢【痛苦面具】

#### $T2$

$c$ 是假的，$\varphi$ 乘一个划分系数即可，看作二进制就可以子集卷积求 $f$，$k^2 2^k log b$，$80$ 分（还是非常一眼的！

正解是我忘记的多项式 exp 求快速幂 😅 $A(x)^k = \exp( k \ln(A(x)) )$，去掉 $log b$ 了。

#### $T3$



## $\mathcal{7.12}$

### $XJOI2759$

#### $T1$

复杂度分析题。性质：

1. $n$ 个点的树，sg 函数 max 为 logn 级别
2. $sg(x) = k$ 的节点 $k$ 的个数为 $n / 2^k$ 级别

设 $mxsg(x)$ 表示 $x$ 能取到的最大 sg 值。状压做下标并（可以不用 FWT），复杂度 $\sum\limits_{i = 1}^n mxsg(i) 2^{mxsg(i)}$，由性质 2 得该复杂度 $= \sum\limits_{i = 0}^{logn} \frac{n}{2^i} i * 2^i = O(nlog^2n)$。
 
#### $T2$

打算订一下？

upd: 写了 fhq treap。

#### $T3$

数组开小气死我了，$log_2 10^5$ 是 $17$ 但是零基础的你都知道要多开一位。

来订正了。带修区间 mex 强制在线——

不会！

智商不够 根号数据结构来凑！

分块，设块长为 $L$

维护第 $i$ 到第 $j$ 个块内的元素构成的 bitset，每次单点修改需要修改 $( \frac{n}{L} )^2$ 个 bitset。O$(\frac{n^3}{L^2} + Q( (\frac{n}{L})^2 + L ))$

$O( \frac{n^2}{64} + n^{5/3} )$ ~~你说对就对吧~~

实测 $L$ 开 $2000$ 左右，虽然是 $2e8$ 级别但是跑的飞快。

---

延熄这事为什么要搞得低声下气啊…… 难道不是你情我愿吗，气死我了。

---

### CF1396E-Distance Matching

## $\mathcal{7.13}$
---

### $XJOI2768$

#### $T1$

乘，取对数变成加，正解分段打表或者斯特林公式（在 $n$ 较大，比如大于 $1e8$ 时较准确）。

#### $T2$

一眼 wqs 二分，运算过程会爆 ll，要开 __int128。切到线段怎么办？不用记录线段两端点，只要记录斜率最后输出乘一下。

#### $T3$

虚树，点分，LCT…… 好像都可以。

### CF1322E-Median Mountain Range

## $\mathcal{7.14}$
---

### $XJOI2773$

#### $T1$

这个「任意角度」很可疑啊！盲猜只要没有隔断，都存在一个角度可以到达 CD。

最小割转对偶图板题。注意删的是点不是边，因此要拆点。输出方案就遍历每条边，在删边的情况下跑最大流看最大流是否减一。微卡常，你当然可以退流，但加个当前弧优化就 win 了。

#### $T2$

写在下面的加强版~~上树版~~ LOJ6509。

#### $T3$

### [$CF1481F-AB\ Tree$](https://www.luogu.com.cn/problem/CF1481F)

## $\mathcal{7.15}$
---

### $XJOI2776$

#### $T1$

$p(n, m) = \frac{\binom{n + m}{n}}{2^{n + m}}$

$f(n, m) = 2^{-n-m} [ (\sum\limits_{i = 0}^n i 2^{i - 1} \binom{n + m - i}{m}) + (\sum\limits_{i = 0}^m i 2^{i - 1} \binom{n + m - i}{n}) ]$

所以就是求 $\sum\limits_{i = 0}^{n - m} i 2^{i - 1} \binom{n - i}{m}$。几何意义见官解。最后变成 $(n + 1) \sum\limits_{i = m}^n \binom{n}{i} - (m + 1) \sum\limits_{i = m + 1}^{n + 1} \binom{n + 1}{i}$，莫队求组合数前缀和。

#### $T2$

$E(x'^2) = (a^2p + 1 - p) E(x^2) + 2abp E(x) + b^2p$，$E(x') = (ap + 1 - p) E(x) + bp$，线段树维护矩乘即可。

#### $T3$

powerful number. 设 $G(n) = n^m$，$F(p) = H(1)G(p) + H(p)G(1)$，得 $H(1) = 1$, $H(p) = 0$——yeah！
$H(p^k)$ 是什么。你看一下 $F(p^2)$、$F(p^3)$ 的式子就发现 $H(p^k) = p^m - p^{2m}$，然后因为它是个积性函数，不同质因子的 $H$ 直接相乘例如 $H(a^2b^2) = H(a^2)H(b^2)$。自然数幂和 $m \leq 3$ 的公式还是要背的：

- $m = 1$: $n(n + 1) / 2$
- $m = 2$: $n(n + 1)(2n + 1) / 6$
- $m = 3$: $n^2(n + 1)^2 / 4$

关于卡常：不要到终点再统计尽管那样没错，边搜边统计是坠吼滴，否则火车头都救不了你。

### CF827F

## $\mathcal{7.16}$
---

没有模拟赛！好耶！

计划：订正 CF732，模拟赛题，CF题，loj题

### 订正了 ECR 111 D ~ F

### [$APIO2021-$封闭道路](https://loj.ac/p/3531)

屑题。这是一棵树。求使得每个点度数至多为 $k$ 的修剪道路的最小代价。~~你若去想卷积什么的那就没救了 /ll~~

暴力：$dp[x, 0/1]$ 表示是否断父边，堆维护，$O(n^2logn)$

正解是从小到大枚举 $k$，把所有度数 $\leq k$ 的点删掉，得到一个森林，每个连通块用暴力做法做，复杂度是 $O(\sum\limits_{i = 1}^n deg_i = 2n - 2)$，但这样的话菊花图就可以把你卡飞

考虑删点的精细维护。若有边 $(u, v, w)$，则删点 $u$ 时，将 $w$ 加入 $v$ 的堆（显然不用考虑它的 dp 值）

每个点在贪心选点时，可以选这个装着删点点权中的元素($I$)，也可以选还未被删的儿子的另一种割边方案（另一个 dp 值）($II$)，维护堆中元素和

单次操作复杂度是 $O(deg)$ 的，但你要记得把 $I$ 中不取弹走的点再**装进来**因为你不能花代价去每次把删掉点的点权 for 一遍装进来，同时你还要把留在堆里的 $II$ 的 dp 值弹走，原因显然。

[$Code$](https://loj.ac/s/1188255)

### $XJOI2787$

#### $T1$

SGT 维护 $y$ 坐标，按 $x$ 从小到大扫。每个节点维护三个量：

- $num[i]$：当前节点 $val = i$ 的个数
- $typ[i, j]$：覆盖当前节点，$y$ 坐标 $\% 5 = i$，$val = j$ 的线段个数
- $pos[i, j]$: 当前节点 $y$ 坐标 $\% 5 = i$，$val = j$ 的个数

标记不下放，$O(25nlogn)$

#### $T2$

考虑暴力做法：枚举断边，$dp[x, 0/1]$ 表示 $x$ 不选/选的最大独立集大小，定一个点是否必须出现在最大独立集内，需要从根往下推

正解：加个换根 dp 维护 dp 数组，动态维护 必不选/必选/皆可 的点数。

#### $T3$

考虑所有的直线都和 $y = x$ 有交，而询问一个 $y = x$ 上的点得到的直线也是在 $y = x$ 上的交点离它最近的线。

于是我们就可以在 $y = x$ 上分治，$[l, r]$，询问 $(mid, mid)$，递归到 $[l, mid - res]$ 和 $[mid + res, r]$。

现在我们初步定下了所有线与 $y = x$ 的交点，如何知晓横竖？假设是竖线，找一个偏僻的横线询问是否切到它，如果没有说明这是横线。显然是 $O(n + m)$。

### UOJ 笔试

周末安排：订正 T2（1h），背诗（15min），一题一课（0.5h）。

感觉思维僵化是不能完全用 CF 好题解决的。决定看数学竞赛教程。

## $\mathcal{7.21}$
---

### $XJOI2812$

#### $T1$

贺的代码…… 我自裁

好妙的状态设计……

我一开始想的是，$dp[x, 0/1]$ 表示前 $x$ 个数能否消成 $0/1$。但是这样一种情况会被重复统计，难搞o

这告诉我们，从某个位置倒回去做是没有前途的，只能设一个巧妙的状态一遍做到尾。

正解只要再加一维，表示加了若干对数，再加一个 $0/1$，能否消成 $0/1$

（这个状态妙在，和以往状态无关，和新加的状态有关，而这个是可枚举的）（所以也不能设 $dp[x, 0/1, 0/1, 0/1]$ 表示前 $x$ 对做完，新加哪两个数，缩得某个数的方案，因为这样在缩的时候要枚举当前最后一位，而这是之前的状态 没法枚举）

实现里为了方便，用一个 $0$ ~ $15$ 的二进制数表示状态，总共 $4$ 位，分别表示加一个 $0/1$ 能否缩成 $0/1$。$dp[x, sta]$ 表示处理了前 $x$ 个位置，当前状态为 $sta$ 的方案数；$trs[sta, 00/01/10/11]$ 表示当前状态为 $sta$，再加两个数字变成哪个状态。

#### $T2$

某点的 SG 函数 = 子树内距离该点最远的点到它的距离，可归纳证明。

根为 $y$ 时，$x$ 的子树 = 所有点刨去「以 $x$ 为根时 $y$ 所在的子树」。预处理出 $x$ 到每个子树的最远距离和次远距离设为 $fi(x)$ 和 $se(x)$，显然 $SG(x)$ 只会等于其中一个。更准确的来说，$fi(x)$ 等于 $x$ 到直径俩端点距离的 max，直径中点到 $y$ 的路径上的点能取 $fi$，其余所有点都是 $se$。

树剖 + SGT。答案等于全局 $se$ 异或一条链上的 $fi$，实际上 SGT 只要支持区间翻转，即在有值和等于零两种状态间翻转。

#### $T3$

元旦老人与丛林，最大权闭合子图。xml 你个 sb 开 $O(n^2)$ 条边干什么呀！

### 订正了 UOJ668

## $\mathcal{7.22}$
---

qy 带着 noi D 类选手们去核酸检测了，下午是自由的，好耶（

upd: 一个小时就回来了，语文课它又活了（大杯

订正昨天 T2

### XJOI2817

xza 的聪明场！

#### $T1$

不妨假设 $n < m$。可以发现上下边界和左右边界的出入状态必须相同，才能对接。走的路线需要密铺，因此每层形状是相同的，看作一个周期。

考虑把路线拍在上下边界和左右边界上，对应 01 串。一个周期的纵向跨度 ($s$) 和横向跨度 ($h$) 之和是 $gcd(n, m)$，并且要满足「走回路」的条件，所以 $h * s = lcm(h, s)$, $s$ 和 $h$ 互质。枚举 $s$ 即可。

#### $T2$

想到对每个环 rand 一个权值，将端点的树上路径 xor 上权值。

删一条边很好做。两条呢？存在结论：只要存在两条边，其权值 xor 起来 = 所有奇环的 xor 值，就是一种合法方案。

分讨，就两种合法情况：
1. 两边合起来恰被所有奇环覆盖一次
2. 一边被若干奇环和偶环覆盖，另一边恰好抵消哪些偶环（不抵消奇环）

结论显而易见。~~可以 yy 这就是充要条件。~~

用 map 会 T，二分就没事—— map 的一只 log 是假的！！！

#### $T3$

写在「LGV 引理」。

### JOI-修行

hhz 讲得太好啦！hhz 一定要保送！祝了他 noi 金色

## $\mathcal{7.24}$
---

### XJOI2839

#### $T1$

直接 BM + 递推就能过，但是被卡常了又不想写多项式取模 T T（其实是没写过并且还懒）题解里给了另一个递推的做法。

#### $T2$

## $\mathcal{7.26}$
---

### NOI2021 同步赛 Day1

但是还没有结束。我要抬着头，走到退役的那天！

### ARC124-D

结论：$1$ ~ $n$ 为红，$n + 1$ ~ $n + m$ 为蓝，连边 $i$ -> $p_i$，形成若干个环和点（这里强调环是点数 $> 1$ 的）答案为 $n + m - K + 2 * max(R, B)$

其中 $K$ 是环总数，$R$ 是仅存在红点的环，$B$ 是仅存在蓝点的环。之所以这么设定是因为每次操作必须选一红一蓝。

那么一次交换操作会改变 $i$、$j$ 所在环的连通性并改变 $K$、$R$、$B$

我们希望 $K = n + m$, $R = 0$, $B = 0$。

答案下界是 $n + m - K + 2 * max(R, B)$，具体证明看官解 ~~没啥意思~~

就是把小环合成大环，再拆解，注意拆解的时候每次选颜色不同的一对 $i$, $j$, $j = p_i$

### ARC124-E

设 $c_i$ 为第 $i$ 个人给右边的球数。$min(c_i) > 0$ 的时候全员减一不会对答案序列产生影响，因此统计 $min(c_i) = 0$ 的时候

dp, $dp[x, 0/1/2, 0/1]$：
- $0$/$1$/$2$: 当前位置的收发情况
- $0$/$1$: 表示目前有无出现 $c_i = 0$

感到非常**谔谔**，应该是这样吧（咕

### ARC124-F

~~感觉并不是很难的题？~~自己想想。

「恰好只遇到一次」像个可以容斥的东西。

$H--$, $W--$。

固定纵向方案，总有一刻骆驼和猫纵向会相距 $H$，因此考虑与之搭配合法的横向方案，那么纵向就是 $\binom{2H}{H}$ 了。

设 $f(n)$ 表示走了 $n$ 列后第一次相遇的方案数, $g(n)$ 表示走了 $n$ 列相遇的方案数

$ans = \binom{2H}{H} \sum\limits_{i = 0}^W f(i) f(W - i)$

$g(n) = \binom{2n + H}{H} \binom{2n}{n}$

枚举一段不允许碰见就是纵向操作数 < 横向操作数

$f(n) = g(n) - 2 \sum\limits_{i = 0}^{n - 1} Cat(i) g(n - 1 - i)$

$Cat$ 为卡特兰数, $Cat(n) = \binom{2n}{n} - \binom{2n}{n - 1}$ ~~是的你没记错，$Cat(n)$ 表示长度为 $2n$ 的合法括号序列数~~

卷积即可。

### 订正了 UOJ669

### 学考成绩出啦

化学生物 A，历史 B，地理 C

*~~话说有 C 会怎么样啊，会被抹杀嘛~~*

化学拿 A 放在期末以前都是不敢相信的事，那时的目标是啥呢，保 C 争 B？/cy

---

noi 差 16 分 Ag——那 20 分拿到就好了呀！熟悉的感觉~~（noiwc 和 noip 都是就差临门一脚）~~

---

感觉自己对 oi 的热情要丧失殆尽了，做点 gym 恢复恢复。

### XXI Tokyo

---

## $\mathcal{7.31}$
---

打了百度之星初赛一，rk 100 出头【yeah】但是订不懂了……

### [$LOJ6509$](https://loj.ac/p/6509)

某校内模拟赛上树版。

期望线性性，考虑每个点贡献 $=$ 作为起点的期望次数 $*$ 到所有点的平均距离。

那就完全撇开距离搞 dp 了

欸，然后你发现这个跳转完全随机，和树的形态完全无关，所以树的作用仅在于求平均距离和

上 树 上 了 个 寂 寞

真正有用的状态是全局黑点数（或白点数）和正在计算的点的颜色

设 $f[i, 0/1]$ 表示全局黑点数为 $i$，当前点（注意**不是所在点**，而只是**在考虑的点**）颜色为白/黑（还没变）的期望出发次数

$f[i, 0] = \frac{i}{n} f[i - 1, 0] + \frac{n - i - 1}{n} f[i + 1, 0] + \frac{1}{n} (f[i + 1, 1] + 1)$

$f[i, 1] = \frac{i - 1}{n} f[i - 1, 1] + \frac{n - i}{n} f[i + 1, 1] + \frac{1}{n} (f[i - 1, 0] + 1)$

第一项表示跳到某个不同色点，当前点不被经过；第二项表示跳到除自己以外的同色点，当前点不被经过；第三项表示跳到自己上，当前点经过并且颜色改变。

注意边界！！

高消不值得，写成矩阵是个带状矩阵的样子（是这样吧）

因此有经典套路：设 $f[1, 0] = x$, $f[1, 1] = y$，$f[i, 0/1]$ 均可表示为 $ax + by + c$ 的形式，最后解个方程。

[$Code$](https://loj.ac/s/1207075)

至于 XJOI2773 T2，规定起点，但只要随机跳一步就变成不定起点的问题了，形态还是条链，所以是严格弱化版（确信