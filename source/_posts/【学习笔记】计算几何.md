---
title: 【学习笔记】计算几何
date: 2021-08-07 12:25:40
tags: 
    - 学习笔记
mathjax: true
---

## 常用向量运算

- 长度 $abs$
- 范数 $norm$（模长平方）较小数开根损精度而且慢
- 极角 $atan2$
- 归一化（转化为单位向量）
- 标量乘除（乘一个数字）
- 加减
- 点积 $dot$
- 叉积 $det$（因为其行列式意义）
- 复数积（旋转, $*(cos + sin * i)$, $(x, y) \rightarrow (x * cos \alpha - y * sin \alpha, x * sin \alpha + y * cos \alpha)$）
  - 特殊：旋转 $90$ 度，最好单独编写函数 $(x, y) \rightarrow (-x, y)$

## zrf 大佬的程序设计建议

- OOP（面向对象编程，对象：逻辑上有联系的数据，逻辑上是整体，便于调试）：其实就是 struct 化？
- FP：将逻辑上的纯函数实现为纯函数（纯函数：不访问全局变量，返回值只与参数有关，不改传进的参数，便于调试）
- 功能细分：即使只有一次调用也划分为单独函数，长函数名当作注释

## 浮点误差

计算机函数的计算无误差，而是存储有误差，会造成 $10^{-15}$ 的误差，对于 sqrt 等函数是致命的

判 $nan$：$nan != nan$

$eps$ 的正确性：为什么实际差 $eps$ 以内的数不会出错？理论分布曲线在 $0$ 左右突变的极陡。*满足这个分布的才能用 $eps$*

在 $0$ 附近扰动会爆炸 $\rightarrow$ 认为他是 $0$

$eps$ 不要滥用，避免在二分中使用 $eps$, instead 直接二分某个常数次。为什么？

二分中使用 $eps$ 会加到答案上去。不写 $eps$ 时的误差仅是 $chk()$ 误差。
- $eps < chk()$ 误差：$while (r - l > eps)$ 无限循环
- $eps > chk()$ 误差：不划算

zrf 大佬发明的：求两个多维空间向量夹角：夹角较小就 $cos$ 算，较大就 $sin$ 算

## 常用运算和表示

- 点：一个向量 $u$
- 直线：一个起点向量 $u$，一个方向向量 $v$；或者两个端点向量
- 角：$(u, v_1, v_2)$
- 圆：圆心 $o$、半径 $r$

- 点和直线位置关系
- 点和圆的位置关系
- 两条线段是否相交（快速排斥实验 + 跨立实验）
- 过定点，直线的垂线、平行线（熟练运用向量旋转）
- 点到直线距离（叉积）
- 点到直线的垂足（点积）
- 垂直平分线
- 角平分线（注意特判共线）
- 两直线的交点
  1. 面积法（任取点）
  2. 代数法（$p = a_1 + c_1 v_1 = a_2 + c_2 v_2$，写成矩阵形式，克莱姆法则）
- 圆和直线交点（注意开根，开根速度可视为 $log$；讨论 $0/1/2$ 个交点）
- 两圆交点（解三角形的圆心角）
- 公切线（放缩 + 平移）

遇事不决，解三角形！勾股yyds。

### 极角排序！

不写 atan2 快 1000 ms！

``` c++
int Qua(Vec a) {  // quadrant 象限
  if (a.x > 0 && a.y >= 0) return 1;
  if (a.x <= 0 && a.y > 0) return 2;
  if (a.x < 0 && a.y <= 0) return 3;
  if (a.x >= 0 && a.y < 0) return 4;
  return 0;
}
bool cmp(Vec a, Vec b) {
  if (Qua(a) == Qua(b)) {
    db t = det(a, b);
    if (!sgn(t)) return a.x < b.x;
    return sgn(t) > 0;
  } return Qua(a) < Qua(b);
}
```

### [清训-定向越野](https://uoj.ac/problem/277)

路径一定是若干段公切线和若干段圆弧。

求出每对圆的四条公切线。公切线求出来还要判是否穿过其他圆，所以是 $O(n^3)$

把切点拿出来跑最短路，同个圆相邻两个切点间连边，共是 $O(n^2)$ 个点和 $O(n^2)$ 条边。

细节：

1. 如何求公切线：设大圆半径为 $r_1$, 小圆半径为 $r_2$，从小圆圆心向大圆半径为 $r_1 \pm r_2$ 的圆求切线，分别两条，然后平移回去。

2. 圆上距离怎么算：半径为 $r$ 的圆上 $A$、$B$ 两点距离为 $d$，圆心角 $= 2 arcsin(\frac{d}{2r})$，或者用 $atan2$ 函数算，减去或者加上 $PI$

3. 如何判线段与圆有两个交点：等价于圆心到线段的距离小于圆半径

坑点：$eps$ 要开 $1e-15$

xml 的丝柏行为：依旧快读读入…… 竟然拿到了 $97$ 的高分 smg？

[$Code$](https://uoj.ac/submission/502617)