---
title: 'AGC 034 题解'
date: 2021-02-21 19:57:40
tags: 
    - 比赛
mathjax: true
hidden: true
---

$A$、$B$ 都很水~~（被 $B$ 卡了一下，我头铁拿队列做）~~ $D$ 也好水，裸的曼哈顿和模拟费用流

剩下三道都不会 awa

## $C$

考虑我们的策略是什么。**思维模式**是，假设已经确定了答案数组 $a$：

- $a_i \geq b_i$，$c_i$ 取 $r_i$
- $a_i < b_i$, $c_i$ 取 $l_i$

于是变成这么个东西：每次选一个 $i$，如果 $a_i + 1 < b_i$，加 $l_i$；如果 $a_i + 1 \geq b_i$, 加 $r_i$

那么每个人就是个分两段的函数：

$$ f(x)=\left\{
\begin{aligned}
l_i x_i, x_i \in [0, b_i) \\
l_i b_i + r_i (x_i - b_i), x_i \in [b_i, X] \\
\end{aligned}
\right.
$$

要让 $\sum x_i$ 最小。

画出来图像就知道了，是一堆斜率中间突增的折线。肯定尽量选 $x = X$ 的时候大的呀因为 $r_i \geq l_i$。可以说明至多只有 $x_i \in [0, x)$，枚举 $i$ 即可。

~~喜欢 $C$ awa~~

## $E$

枚举相聚点作为 $root$。每次可以选择两个没有祖先关系的点操作一次，都向根靠近一步。「靠近一步」这个条件不爽快，考虑把每个棋子 $x$ 拆成 $dis(x, rt)$ 个棋子排在 $x$ 到根的路径上。现在的问题转化为一个经典模型：有 $sum$ 个点根据「祖先关系」被划分为若干点集，每次可选两个不同集合的点**匹配**并抵消。

套路的，设 $mxsum$ 为最大的 $x$ 儿子子树棋子数，$sum_x$ 为 $x$ 子树棋子数。设 $f_x$ 表示 $x$ 子树能匹配多少对。$sum_x - mxsum \geq mxsum$ 时全都能抵消，$f_x = sum_x / 2$；否则 $f_x = sum_x - mxsum + min(f_{mxid}, mxsum - sum_x / 2)$。

## $F$

决定拿一个小时刚一下 $F$。~~FWT 谁不爱呢！~~

是 $e_i$ 表示把 $x$ 变成 $i$ 的期望步数。$i = 0$ 时，$e_i = 0$; $i \neq 0$ 时，$e_i = 1 + \sum\limits_{j = 0}^{2^n - 1} e_{i \oplus j} p_j$。

拿生成函数优化，设 $E$ 为 $e$ 的集合幂级数，$P$ 为 $p$ 的集合幂级数，$I$ 为每项都为 $1$ 的常函数。**这些还不够！** 两边系数和不等！需要引入修正因子 $C$，即 $E * P + I = E + C$。解得 $C_0 = 2^n$。**注意这里只是让等式平衡了，$e_0$ 依旧不为 $0$ 因此最终整个 $e$ 要平移 $-e_0$ 位。**

$E = \frac{C - I}{P - 1}$，直接 FWT 后对应位相除。~~顺带说一句 $C$ 的 FWT 每项都是 $c$（不关健）~~

**不能忽视修正因子啊。**