---
title: 'zzd《FFT入门》题解'
date: 2020-07-30 20:27:40
tags: 
    - FFT
mathjax: true
---

# **套路1. 字符串匹配**
-----

我们发现匹配的字符对**下标之差是定值**，翻转其中一个串以后就变成了，匹配的字符对**下标之和是定值**，这是满足卷积形式的。（好妙啊QAQ，卷积形式真的万能

## $\mathcal{[BZOJ4503]}$

不能直接 kmp 啊，通配符的 fail 指针不好定。考虑卷积。

我们希望通过某一位是否为 0 来判断能否在某位匹配上。可以让相同字符差为 0，做一个平方就不会有“正 + 负 = 零”的情况发生。

但通配符怎么搞？它可以与任何字符配啊。我们希望有通配符存在 就是 0，那么通配符值 = 0，乘到柿子里去就好了。

### $$\sum\limits_{i = 1}^n\sum\limits_{j = 1}^ m (S_i - T_j)^2 S_i T_j$$

这个东西拆开来，做三次 FFT。

## $\mathcal{[CF528D]}$

按照上一题的套路，我们设 $f[i, c]$ 表示 $[A 的位置 i 匹配字符 c]$，$g[i, c]$ 表示 $[B 的位置 i == c]$。相减之后做平方，这个东西展开太困难了，而且要做很多次 FFT，常数爆炸，考虑别的方法。

显然 $f[i, c]$ 和 $g[i, c]$ 只是 0/1，若 $A[i]$ 能匹配上 $B[j]$，那么存在一个 $c$，$f[i, c] \times g[j, c] = 1$。

发现字符集很小，我们分别对每种字符做一次卷积，若位置 i 的四种值之和 == $|B|$ 则位置 $i - |B| + 1$ 可以匹配。复杂度$O(4nlogn)$.

# **套路2. 卷积形式变形**
-----

常用技巧是翻转和更换求和指标。

## $\mathcal{[ZJOI2014]-力}$

自己还推了一部分，hh

设 $F(i) = \frac{1}{i^2}$，$G(i) = q_i$，一些不合法的下标，值为 0.

$$E(i) = (\sum\limits_{j = 0}^iF(j) \times G(i - j)) - (\sum\limits_{j = i}^m F(j - i) \times G(j))$$

第一个括号里是裸的卷积形式，第二个括号要再做一做。

更换求和指标：

$$\sum\limits_{j = 0}^{m - i} F(j) \times G(j + i)$$

翻转：（其中 $G^r(i)$ 表示 $G(m - i)$）

$$\sum\limits_{j = 0}^{m - i} F(j) \times G^r(m - i - j)$$

# **套路3. 背包问题相关**
-----

## $\mathcal{[CF286E]-Ladies'\ Shop}$

比较自然的想法，f[a[i]] = 1，f[0] = 1，f 与自己做卷积，做最多 m 次就得到了所有能表示的数。但这样是 O(m log^2 m)的。

但其实并不用做 m 次。实际上一次卷积就能得出答案。

一次卷积后，那些 f[i] > 2 的 i 就是可以省略的。为什么？初始一次，f[i] 与 f[0] 相乘一次，还有其他能组成 i 的数字的贡献... 反过来说，f[i] = 2 的 i 就是必选的。

# **套路4. 分治FFT**
-----

（好难啊 QAQ 我没有脑子）

## $\mathcal{[Lydsy1704月赛]-二元运算}$

先不考虑括号里的限制。加法可以直接算，减法要变一下：

$$ans_j = \sum\limits_{i = j}^n a_i * b_{i - j}$$

$$ans_j = \sum\limits_{i = 0}^{n - j} a_{i + j} * b_i$$

翻转

$$ans_j = \sum\limits_{i = 0}^{n - j} a_{i + j} * b^r_{n - j - i}$$

考虑括号里的限制，容易发现在值域上，左区间对右区间一定有贡献，于是想到**分治值域**。

（我今天才知道在递归过程中计算一个子问题对另一个子问题的贡献的分治就叫 CDQ 分治？？？）

## $\mathcal{[CF553E]-Kyoya\ and\ Train}$

# **杂题**
-----

## $\mathcal{[BZOJ3160]-万径人踪灭}$

## $\mathcal{[Cerc2015]-Frightful\ Formula}$

## $\mathcal{[Hnoi2017]-礼物}$

## $\mathcal{[CF958F3]-Lightsabers(hard)}$

## $\mathcal{[CF623E]-Transforming\ Sequence}$