---
title: '四种树的计数'
date: 2020-12-06 23:14:05
tags: 
    - 生成函数
mathjax: true
---

## 有标号无根树

$n^{n - 2}$

## 有标号有根树

$n^{n - 1}$

## 无标号有根树

设 $f_i$ 表示大小为 $i$ 的树的方案数，其生成函数为 $F(z) = \sum\limits_{i \geq 0} f_i z^i$，则

$$F(z) = z \prod\limits_{i \geq 0} (1 - z^i)^{-f_i}$$

取对数

$$\ln{F(z)} = \ln{z} + \sum\limits_{i \geq 0} \ln((1 - z^i)^{-f_i})$$

$$= \ln{z} - \sum\limits_{i \geq 0} f_i \ln(1 - z^i)$$

求导

$$\frac{F'(z)}{F(z)} = \frac{1}{z} + \sum\limits_{i \geq 0} f_i \frac{i z^{i - 1}}{1 - z^i}$$

化简

$$z F'(z) = F(z) + F(z) \sum\limits_{i \geq 0} f_i i \frac{z^i}{1 - z^i}$$

只看第 $n$ 项系数

$$n f_n = f_n + \sum\limits_{i = 1}^{n - 1} f_i  \sum\limits_j [j \mid n - i] f_j j$$

$$f_n = \frac{1}{n - 1}( \sum\limits_{i = 1}^{n - 1} f_i \sum\limits_j [j \mid n - i] f_j j )$$

可以用分治 NTT 解决。~~假装我会吧，现在实在没心情写~~

## 无标号无根树

设 $g_i$ 表示无根树的方案，$f_i$ 同上。考虑无根树可以用重心表示，所以把不是重心的答案都减去。

$$h_n = f_n - \sum\limits_{i = 1}^{n / 2} f_i f_{n - i}$$

注意当 $n$ 为偶数时要特判，加上 $f_{n / 2}^2 - \binom{f_{n / 2}}{2}$。