---
title: 'xza Ptz&Opencup 趣题选讲'
date: 2021-08-11 14:37:40
tags: 
mathjax: true
---

## [$Automorphism$](https://www.acmicpc.net/problem/19017)

题意：Chihiro 有一棵有根树 T，一开始只有根节点 1。接下来会有 m 次事件，Chihiro 会增加一个叶子节点，或者询问子树 u 的自同构数量。数据范围：n, m ≤ 10^5

自同构就是一个标号排列映射到另一个排列，树的结构相同。

和 UNR#5 D1T2 比较像，但那题子树形态不确定，这题会动态加点。

定义 Hash 函数为与节点深度有关，如果重链剖分了，每次修改只要改 $logn$ 个轻边父亲。离线，启发式合并，以时间为下标维护若干个区间。重儿子直接继承，轻儿子做区间并，$O(nlog^2n)$

如果 Hash 函数以子树 $size$ 为内容，大概要个 ddp？

## [$LCM$ $sum$](https://www.acmicpc.net/problem/18764)

容易想到 $k$ 很小因此 $[x, x + k]$ 的公共质因子不超过 $k$，其余的质因子可以除掉，递归……？

实际上设 $L = lcm(1, \cdots, k)$, 对于一个模 $L$ 等于 $r$ 的 $x$ 等价类，$\frac{x(x + 1) \cdots (x + k)}{lcm(x, x + 1, \cdots, x + k)}$ 是固定整数 $c_r$，这是因为 $> k$ 的质因子都被除掉了……！

$lcm(x, x + 1, \cdots, x + k) = \frac{1}{c_r} \sum coef_i * (Lt + r)^i$。那么你会 $O(Lk)$ 了。

但 $L$ 实际上是 $10^{12}$ 级别的！考虑把 $L$ 分成若干互质的 $L_i$ 乘积，分成两个就够复杂度了比如说分成 $L_1 * L_2$, $gcd(L_1, L_2) = 1$, $\prod$ 和 $lcm$ 也分开来，$c_r$ 就等于 $c'_{r\ mod\ L_1 = r_1} * c^{''}_{r\ mod\ L_2 = r_2}$

即我们计算 $x \equiv r_1 \pmod{L_1} 和 x \equiv r_2 \pmod{L_2}$ 的答案拼给 $x \equiv r \pmod{L}$（$r \equiv r_1 v_1 + r_2 v_2 \pmod{L}$）。具体来说根据 $r_1 v_1 + r_2 v_2$ 是否超过 $L$ 以及 $r$ 是否超过 $n\ mod\ L$ 分区间统计，什么枚举 $r_1 v_1$ 二分找到对应的 $r_2 v_2$ 区间之类的。$O(\sqrt{L} k^2)$，大概因为拼起来是 $k^2$ 的。

## [$The$ $Hash$ $Table$](https://www.acmicpc.net/problem/21108)

题意：Chihiro 有一张大小为 m 的 Hash 表。接着 Chihiro 会依次插入 x = 0, 1, · · · , n − 1 到位置 x^2 mod m，若当前位置已经有 T 个数，那么需要支付 T 的代价来插入 x。 问总代价是多少。n, m ≤ 10^9

超妙的好题！！

等价于统计 $x^2 \equiv y^2 \pmod{m}$ 的对数，$x^2 \equiv y^2 \pmod{m} \Longleftrightarrow (x + y)(x - y) \equiv 0 \pmod{m}$，考虑枚举 $(x + y)$ 和 $(x - y)$ 与 $m$ 的 gcd $g_1$ 和 $g_2$，若 $g_1 * g_2 \equiv 0 \pmod{m}$ 就合法。

若 $m = p^k$，枚举 $g_1$ 为 $p^i$，注意为了不算重，统计的是 $g_1$ *恰好* $= p^i$。设 $f(g_1, g_2)$ 表示 $g_1 \mid (x + y), g_2 \mid (x - y)$ 的 $(x, y)$ 对数，则 $g_1 = p^i$ 的答案 $= \sum\limits_{i = 0}^k f(p^i, p^{k - i}) - f(p^{i + 1}, p^{k + 1 - i})$

至于一般情况 $m = \prod_i p_i^{k_i}$, 还是枚举 $g_i$，枚举量仅有 $\prod (2k_i + 1) = d(m^2)$，其中 $d$ 为约数个数，是 $\sqrt{m^2}$ 级别并且实际上小很多。

现在的问题在于计算 $f(g_1, g_2)$。

令 $x + y = p g_1$, $x - y = q g_2$，$f(g_1, g_2)$ 等于合法 $(p, q)$ 对数，合法指的是满足 $x, y \in [0, n - 1]$。$x = \frac{pg_1 + q g_2}{2}, y = \frac{p g_1 - q g_2}{2}$，于是可以得到关于 $p$、$q$ 的线性不等式，画在平面上为询问一个区域内的整点个数，分割区域 + 类欧！写起来应该很(dàn)爽(téng)，因为式子存在除 $2$，还要枚举 $p$、$q$ 的奇偶。$O(d(m^2) log m)$（类欧是 $log$ 的

## $Game$

（这是一道 Bytedance 题，无链接

题意：Chihiro 和 Kohakunushi 在玩一个游戏。有两个长度分别为 n, m 的序列 a, b，分别有一个指针 c, d，一开始均为 1。两人轮流游戏，Chihiro 先手，可行进行两种操作：
1. 移动一个序列的指针，不能移动到原来的位置，且移动后的状态 (c, d) 不能在此前出现过。我们认为 (1, 1) 在一开始已经出现过
2. 结束游戏，分数为 ac + bd

Chihiro 会最小化游戏分数，而 Kohakunushi 会最大化它，求最终分数

首先排序。每个状态可以抽象为一个矩阵（或一个二维平面）上的点，并且这个矩阵越往右越往下数越大。先后手每次在一行或一列中移动，不经过重复点。还是没法做，数种类太多了，我们需要二分转判定，即划一条分界线使得左上都是白，右下都是黑，先手想走到白，后手想走到黑——这个暗示已经足够明显了，二分图博弈。

二分图博弈有个什么定理来着——无向点地理问题。~~真的是暗藏玄机= =，你去翻了翻定义发现有句「“不允许访问重复节点”」奇怪的条件终于破案了。~~ 先手有必胜策略当且仅当起点（注意排序后不是 $(1, 1)$ 了）在所有最大匹配上，判断就断掉起点所有邻边再跑最大匹配。

但是这个图看似特殊，最大匹配却不好做。你想试试网络流判定，但相比图也大得很……

注意到最大匹配 $=$ 点数 - 最大独立集，又注意到左上角的一块白色一定选了不劣，更进一步发现最优方案是左上角一个矩形和右下角一个矩形，并且在两个矩形恰好交于一个顶点。确定了左上那块 $r * c$ 的就能确定右下，而 $c$ 关于 $r$ 单调不增，双指针即可。$O(nlogV)$